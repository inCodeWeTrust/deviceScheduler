<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>deviceScheduler: deviceScheduler.ino</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">deviceScheduler
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">deviceScheduler.ino</div>  </div>
</div><!--header-->
<div class="contents">
<p>This is the code for cutting records</p>
<div class="fragment"><div class="line">    scheduler = <span class="keyword">new</span> <a name="_a0"></a><a class="code" href="class_c_c_device_scheduler.html">CCDeviceScheduler</a>;</div><div class="line">   </div><div class="line">    <span class="comment">// ============================================================================================================================</span></div><div class="line">    <span class="comment">// ============= devices ======================================================================================================</span></div><div class="line">    <span class="comment">// ============================================================================================================================</span></div><div class="line">    <a class="code" href="device_scheduler_8h.html#a47bba564f12254766f966aa6e7beec94">schedulerDevice</a> liftServo = scheduler-&gt;<a name="a1"></a><a class="code" href="class_c_c_device_scheduler.html#a8a90d14067f097bf18742e4c377d2d1b">addServo</a>(<a name="a2"></a><a class="code" href="device_scheduler_8h.html#a0a85236607721bb3c9802dd2f2ed86a5">SERVO_LIFT_NAME</a>, <a name="a3"></a><a class="code" href="device_scheduler_8h.html#aab9e8cfdacc8d775ccf868a4e4c2614e">SERVO_LIFT_PIN</a>, <a name="a4"></a><a class="code" href="device_scheduler_8h.html#a4d651709ee6d844cb10d2ebcd7a00ff9">SERVO_LIFT_MIN_POSITION</a>, <a name="a5"></a><a class="code" href="device_scheduler_8h.html#a0b403a75b9c6eae434eb53c3422486b8">SERVO_LIFT_MAX_POSITION</a>, <a name="a6"></a><a class="code" href="device_scheduler_8h.html#a17aa51a7e69184c7b66d1ba16ce5091c">LIFT_PARK_POSITION</a>);</div><div class="line">   </div><div class="line">    <a class="code" href="device_scheduler_8h.html#a47bba564f12254766f966aa6e7beec94">schedulerDevice</a> turnServo = scheduler-&gt;addServo(<a name="a7"></a><a class="code" href="device_scheduler_8h.html#af8f685fb9cd75e233c5751ec196c86cf">SERVO_TURN_NAME</a>,</div><div class="line">                                                <a name="a8"></a><a class="code" href="device_scheduler_8h.html#ae32e485bb1480eef2def565598e2ca23">SERVO_TURN_PIN</a>,</div><div class="line">                                                <a name="a9"></a><a class="code" href="device_scheduler_8h.html#a6c0c287944cda1088e9fcf388ac7b7bd">SERVO_TURN_MIN_POSITION</a>,</div><div class="line">                                                <a name="a10"></a><a class="code" href="device_scheduler_8h.html#ab3a57da8611ea208a5c35c0613582081">SERVO_TURN_MAX_POSITION</a>,</div><div class="line">                                                <a name="a11"></a><a class="code" href="device_scheduler_8h.html#a61e9b731a1b8ea9b40a5e6ab61b0ed50">TURN_PARK_POSITION</a>);</div><div class="line">freeRam();</div><div class="line"><a class="code" href="device_scheduler_8h.html#a47bba564f12254766f966aa6e7beec94">schedulerDevice</a> headLeftServo = scheduler-&gt;addServo(<a name="a12"></a><a class="code" href="device_scheduler_8h.html#a62c9256e32d50fb50dbde83d5237f7b4">SERVO_HEAD_LEFT_NAME</a>,</div><div class="line">                                                    <a name="a13"></a><a class="code" href="device_scheduler_8h.html#ae47d6fb0be92c092d465587302b9cb7d">SERVO_HEAD_LEFT_PIN</a>,</div><div class="line">                                                    <a name="a14"></a><a class="code" href="device_scheduler_8h.html#a384213179781815e4349d4d118ddb66a">SERVO_HEAD_LEFT_MIN_POSITION</a>,</div><div class="line">                                                    <a name="a15"></a><a class="code" href="device_scheduler_8h.html#aa67a5a4624adcfa30aca1677b9621882">SERVO_HEAD_LEFT_MAX_POSITION</a>,</div><div class="line">                                                    <a name="a16"></a><a class="code" href="device_scheduler_8h.html#a13f64fe860349c5139a8109e7856dc2d">HEAD_LEFT_PARK_POSITION</a>);</div><div class="line">freeRam();</div><div class="line"><a class="code" href="device_scheduler_8h.html#a47bba564f12254766f966aa6e7beec94">schedulerDevice</a> headRightServo = scheduler-&gt;addServo(<a name="a17"></a><a class="code" href="device_scheduler_8h.html#acdc193489e1a5e659243c9610fd9fc53">SERVO_HEAD_RIGHT_NAME</a>,</div><div class="line">                                                     <a name="a18"></a><a class="code" href="device_scheduler_8h.html#a151eb770b03027db328b90696d276e1b">SERVO_HEAD_RIGHT_PIN</a>,</div><div class="line">                                                     <a name="a19"></a><a class="code" href="device_scheduler_8h.html#a9b03a3b5d490b6ae722260d521a6d7f7">SERVO_HEAD_RIGHT_MIN_POSITION</a>,</div><div class="line">                                                     <a name="a20"></a><a class="code" href="device_scheduler_8h.html#ac32296cea3b9cd484b7edfe9eaadd35a">SERVO_HEAD_RIGHT_MAX_POSITION</a>,</div><div class="line">                                                     <a name="a21"></a><a class="code" href="device_scheduler_8h.html#ac3bcfb2f35c85cb731bac558a3bec28b">HEAD_RIGHT_PARK_POSITION</a>);</div><div class="line">freeRam();</div><div class="line"><a class="code" href="device_scheduler_8h.html#a47bba564f12254766f966aa6e7beec94">schedulerDevice</a> stockStepper = scheduler-&gt;addStepper_A4988(<a name="a22"></a><a class="code" href="device_scheduler_8h.html#a7eacd396665ff655dc7f5eeeafd66a1c">STEPPER_STOCK_NAME</a>,</div><div class="line">                                                           <a name="a23"></a><a class="code" href="device_scheduler_8h.html#a1203c4ec01180a3daf99060ce1ca02a2">STEPPER_STOCK_STEP_PIN</a>,</div><div class="line">                                                           <a name="a24"></a><a class="code" href="device_scheduler_8h.html#a6e96f0541b99315307b0412db638a2e2">STEPPER_STOCK_DIR_PIN</a>,</div><div class="line">                                                           <a name="a25"></a><a class="code" href="device_scheduler_8h.html#a84defb5fafcc555793e9f221bca23411">STEPPER_STOCK_ENABLE_PIN</a>,</div><div class="line">                                                           <a name="a26"></a><a class="code" href="device_scheduler_8h.html#a047cb55a599d8fa561f3008e491f5839">STEPPER_STOCK_HIGHEST_STEPPINGMODE</a>,</div><div class="line">                                                           <a name="a27"></a><a class="code" href="device_scheduler_8h.html#a7af7e2994c2c84c87dfc13947d9f1023">STEPPER_STOCK_STEPMODECODES</a>,</div><div class="line">                                                           <a name="a28"></a><a class="code" href="device_scheduler_8h.html#aabcce1e34440d5f29e7c41c4a1414418">STEPPER_STOCK_MICROSTEPPINS</a>,</div><div class="line">                                                           <a name="a29"></a><a class="code" href="device_scheduler_8h.html#ae9da98bec12c519950c375b85ea76503">STEPPER_STOCK_STEPS_PER_ROTATION</a>);</div><div class="line"></div><div class="line"><a class="code" href="device_scheduler_8h.html#a47bba564f12254766f966aa6e7beec94">schedulerDevice</a> tableStepper = scheduler-&gt;addStepper_A4988(<a name="a30"></a><a class="code" href="device_scheduler_8h.html#a3bb33428a94f5e6d24bb12fa2cf822ba">STEPPER_TABLE_NAME</a>,</div><div class="line">                                                           <a name="a31"></a><a class="code" href="device_scheduler_8h.html#a32be260c44f2e5034b08a4a9d3c358e7">STEPPER_TABLE_STEP_PIN</a>,</div><div class="line">                                                           <a name="a32"></a><a class="code" href="device_scheduler_8h.html#a3297162095ccd665261382c13e8ac0f5">STEPPER_TABLE_DIR_PIN</a>,</div><div class="line">                                                           <a name="a33"></a><a class="code" href="device_scheduler_8h.html#abdbca8b6a1e51e1d161b6d6d90a4f26c">STEPPER_TABLE_ENABLE_PIN</a>,</div><div class="line">                                                           <a name="a34"></a><a class="code" href="device_scheduler_8h.html#a1b65709c246fc0530bc1c52f15ee09b7">STEPPER_TABLE_HIGHEST_STEPPINGMODE</a>,</div><div class="line">                                                           <a name="a35"></a><a class="code" href="device_scheduler_8h.html#af2e7602a2e6cc110f0514ec21e797777">STEPPER_TABLE_STEPMODECODES</a>,</div><div class="line">                                                           <a name="a36"></a><a class="code" href="device_scheduler_8h.html#a39a27b60baadfd8d1d8bf21dfcd95e20">STEPPER_TABLE_MICROSTEPPINS</a>,</div><div class="line">                                                           <a name="a37"></a><a class="code" href="device_scheduler_8h.html#ab1abcb91bb9f2dc57d44a2638e226f64">STEPPER_TABLE_STEPS_PER_ROTATION</a>);</div><div class="line"></div><div class="line"><a class="code" href="device_scheduler_8h.html#a47bba564f12254766f966aa6e7beec94">schedulerDevice</a> catStepper = scheduler-&gt;addStepper_TMC260(<a name="a38"></a><a class="code" href="device_scheduler_8h.html#a1e7a085a9da7fd53cf053b586c380718">STEPPER_CAT_NAME</a>,</div><div class="line">                                                          <a name="a39"></a><a class="code" href="device_scheduler_8h.html#a0fbf4192dc87fb7d5739c002d9283bb6">STEPPER_CAT_STEP_PIN</a>,</div><div class="line">                                                          <a name="a40"></a><a class="code" href="device_scheduler_8h.html#a03c92b4f69f770d594c1b60fa7cb878b">STEPPER_CAT_DIR_PIN</a>,</div><div class="line">                                                          <a name="a41"></a><a class="code" href="device_scheduler_8h.html#ab10854a52441abd952c843836970f5a5">STEPPER_CAT_ENABLE_PIN</a>,</div><div class="line">                                                          <a name="a42"></a><a class="code" href="device_scheduler_8h.html#a2bf0e4ddcec0e3c1d0a67e6aaef88ead">STEPPER_CAT_CHIPSELECT_PIN</a>,</div><div class="line">                                                          <a name="a43"></a><a class="code" href="device_scheduler_8h.html#ac025c34ada28499f2a8f80003ef2dc97">STEPPER_CAT_CURRENT</a>,</div><div class="line">                                                          <a name="a44"></a><a class="code" href="device_scheduler_8h.html#a795244b08d6eab13c9c8cff8098ee3c9">STEPPER_CAT_STEPS_PER_ROTATION</a>);</div><div class="line"></div><div class="line">freeRam();</div><div class="line"><a class="code" href="device_scheduler_8h.html#a47bba564f12254766f966aa6e7beec94">schedulerDevice</a> tableDrive = scheduler-&gt;addDcController(<a name="a45"></a><a class="code" href="device_scheduler_8h.html#a40dcf06237fd7824c348205bb123b44a">TABLEDRIVE_NAME</a>, <a name="a46"></a><a class="code" href="device_scheduler_8h.html#a135323016f0753147a354bde2507d9d0">TABLEDRIVE_PIN</a>, <a name="a47"></a><a class="code" href="device_scheduler_8h.html#a5cbc0d740c752093e24451a1cf8204cc">TABLEDRIVE_ACTIV</a>);</div><div class="line">freeRam();</div><div class="line"></div><div class="line"></div><div class="line">scheduler-&gt;getAllDevices();</div><div class="line"></div><div class="line"><a class="code" href="device_scheduler_8h.html#afdf0c93f269ef2ece4b433be7117f927">schedulerControlButton</a> songEndButton = scheduler-&gt;addControlButton(<a name="a48"></a><a class="code" href="device_scheduler_8h.html#aee658e3f03d4935346ca8ca8bee2618c">SONG_END_BUTTON_NAME</a>, <a name="a49"></a><a class="code" href="device_scheduler_8h.html#abc781360180894ab49a4fa32b1e03637">SONG_END_PIN</a>, <a name="a50"></a><a class="code" href="device_scheduler_8h.html#aa7ab3303e4648bb2d046cc2ca99d17e4">SONG_END_ACTIV</a>);</div><div class="line"><a class="code" href="device_scheduler_8h.html#afdf0c93f269ef2ece4b433be7117f927">schedulerControlButton</a> songCancelButton = scheduler-&gt;addControlButton(<a name="a51"></a><a class="code" href="device_scheduler_8h.html#ae5e0f66e0c263690f331e2527ccd0c1b">SONG_CANCEL_BUTTON_NAME</a>, <a name="a52"></a><a class="code" href="device_scheduler_8h.html#ac41fbaa0f9000eb0fe09fa1f04d0ae99">SONG_CANCEL_PIN</a>, <a name="a53"></a><a class="code" href="device_scheduler_8h.html#a43c7f34c989cba0fbd3a31e0e963e3df">SONG_CANCEL_ACTIV</a>);</div><div class="line"></div><div class="line">scheduler-&gt;getAllControlButtons();</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordflow">for</span> (;;) {</div><div class="line">    </div><div class="line">    <span class="comment">// ============================================================================================================================</span></div><div class="line">    <span class="comment">// ============= moves ========================================================================================================</span></div><div class="line">    <span class="comment">// ============================================================================================================================</span></div><div class="line">    </div><div class="line">    <span class="comment">// ########## scheduledTask addTaskWithStartDelay(float target, unsigned long startDelay, float velocity, float acceleration, float deceleration);</span></div><div class="line">    <span class="comment">// ########## scheduledTask addTask(float target, float velocity, float acceleration, float deceleration) {</span></div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment">// ########## startByDate(unsigned long startTime)</span></div><div class="line">    <span class="comment">// ########## startByButton(unsigned char startButton, boolean startButtonState)</span></div><div class="line">    <span class="comment">// ########## startByTriggerpositionOf(schedulerDevice startTriggerDevice, scheduledTask startTriggerTask, signed long startTriggerPosition)</span></div><div class="line">    </div><div class="line">    <span class="comment">// ########## setDisposeAfterTask(unsigned char stopTriggerDevice, unsigned char stopTriggerTask)</span></div><div class="line">    </div><div class="line">    <span class="comment">// ########## switchToNextTaskByDate(unsigned long startTime);</span></div><div class="line">    <span class="comment">// ########## switchToNextTaskByButton(unsigned char startButton, boolean startButtonState);</span></div><div class="line">    <span class="comment">// ########## switchToNextTaskByTriggerpositionOf(schedulerDevice switchingTriggerDevice, scheduledTask switchingTriggerTask, signed long startTriggerPosition);</span></div><div class="line">    </div><div class="line">    <span class="comment">// ########## stopByTimeout(unsigned long timeout, stoppingMode stopping)</span></div><div class="line">    <span class="comment">// ########## stopByButton(unsigned char stopButton, boolean stopButtonState, stoppingMode stopping)</span></div><div class="line">    <span class="comment">// ########## stopByTriggerpositionOf(schedulerDevice stopTriggerDevice, scheduledTask stopTriggerTask, signed long stopTriggerPosition, stoppingMode stopping)</span></div><div class="line">    </div><div class="line">    <span class="comment">//  stopping:  STOP_IMMEDIATELY, STOP_NORMAL</span></div><div class="line">    </div><div class="line">    <span class="comment">// ============================================================================================================================</span></div><div class="line">    <span class="comment">// ============================================================================================================================</span></div><div class="line">    <span class="comment">// ============================================================================================================================</span></div><div class="line">    </div><div class="line">    </div><div class="line">    </div><div class="line">    scheduler-&gt;device[catStepper]-&gt;currentPosition = 0;</div><div class="line">    </div><div class="line">    </div><div class="line">    Serial.println(<span class="stringliteral">&quot;................................. initialisation .................................&quot;</span>);</div><div class="line">    </div><div class="line">    </div><div class="line">    <a class="code" href="device_scheduler_8h.html#ae5841fd44d6e01bbac6e04706ff5c9db">scheduledTask</a> initCatStepper = scheduler-&gt;device[catStepper]-&gt;addTask(-400000, <a name="a54"></a><a class="code" href="device_scheduler_8h.html#a4e9530a03f2c27679e26832537179314">CAT_SPEED_VERY_HIGH</a>, <a name="a55"></a><a class="code" href="device_scheduler_8h.html#abb9024e808a0c11b2aed08583d9a09be">CAT_ACCEL_VERY_HIGH</a>, <a class="code" href="device_scheduler_8h.html#abb9024e808a0c11b2aed08583d9a09be">CAT_ACCEL_VERY_HIGH</a>);</div><div class="line">    scheduler-&gt;device[catStepper]-&gt;task[initCatStepper]-&gt;startByDate(100);</div><div class="line">    scheduler-&gt;device[catStepper]-&gt;task[initCatStepper]-&gt;stopByButton(<a name="a56"></a><a class="code" href="device_scheduler_8h.html#a4aa4f72b5f68cf77a095aafad97d97dd">CAT_PARK_BUTTON</a>, HIGH, <a name="a57"></a><a class="code" href="device_scheduler_8h.html#a82b311bea6cf44d0e38e302ad9457af9a912a5244b1552dfb596bfbc3bb124bc0">STOP_NORMAL</a>);</div><div class="line">    </div><div class="line">    scheduler-&gt;reviewTasks();</div><div class="line">    scheduler-&gt;getAllTasks();</div><div class="line">    </div><div class="line">    scheduler-&gt;run();</div><div class="line">    </div><div class="line">    scheduler-&gt;deleteAllTasks();</div><div class="line">    scheduler-&gt;deleteAllActions();</div><div class="line">    </div><div class="line">    </div><div class="line">    Serial.println(<span class="stringliteral">&quot;...................................... done ......................................&quot;</span>);</div><div class="line">    </div><div class="line">    </div><div class="line">    scheduler-&gt;device[catStepper]-&gt;currentPosition = 0;</div><div class="line">    scheduler-&gt;device[tableStepper]-&gt;currentPosition = 0;</div><div class="line">    </div><div class="line">    <span class="keywordflow">if</span> (digitalRead(<a name="a58"></a><a class="code" href="device_scheduler_8h.html#a5ab1577d0a4a90cd4496238e320e3150">NORMAL_CUTTING</a>) == HIGH) {</div><div class="line">        </div><div class="line">        freeRam();</div><div class="line">        </div><div class="line">        <span class="comment">//  move to start groove:</span></div><div class="line">        <a class="code" href="device_scheduler_8h.html#ae5841fd44d6e01bbac6e04706ff5c9db">scheduledTask</a> driveToCuttingStartPosition = scheduler-&gt;device[catStepper]-&gt;addTask(<a name="a59"></a><a class="code" href="device_scheduler_8h.html#a65026c4ddcb978085f689a42de579221">CAT_CUTTING_START_POSITION</a>, <a name="a60"></a><a class="code" href="device_scheduler_8h.html#a95580629d12e0a7bed5b1e0ff8fa755b">CAT_SPEED_HIGH</a>, <a name="a61"></a><a class="code" href="device_scheduler_8h.html#aa607ecf76abb41572956668e9ce39bc4">CAT_ACCEL_HIGH</a>, <a class="code" href="device_scheduler_8h.html#aa607ecf76abb41572956668e9ce39bc4">CAT_ACCEL_HIGH</a>);</div><div class="line">        scheduler-&gt;device[catStepper]-&gt;task[driveToCuttingStartPosition]-&gt;startByDate(100);</div><div class="line">        <span class="comment">//            scheduler-&gt;device[catStepper]-&gt;task[driveToCuttingStartPosition]-&gt;stopByButton(CAT_END_BUTTON, HIGH, STOP_NORMAL);</span></div><div class="line">        </div><div class="line">        <span class="comment">//  turn the table:</span></div><div class="line">        <a class="code" href="device_scheduler_8h.html#ae5841fd44d6e01bbac6e04706ff5c9db">scheduledTask</a> turnTheTable = scheduler-&gt;device[tableStepper]-&gt;addTask(grooves_all * 3600, turnTableStepperSpeed, <a name="a62"></a><a class="code" href="device_scheduler_8h.html#ac111d7db8684022da12c8afaa5a04ac9">TABLE_STEP_ACCEL</a>, <a class="code" href="device_scheduler_8h.html#ac111d7db8684022da12c8afaa5a04ac9">TABLE_STEP_ACCEL</a>);</div><div class="line">        scheduler-&gt;device[tableStepper]-&gt;task[turnTheTable]-&gt;startAfterCompletionOf(catStepper, driveToCuttingStartPosition);</div><div class="line">        <span class="comment">//            scheduler-&gt;device[tableDrive]-&gt;task[turnTheTable]-&gt;startByTriggerpositionOf(catStepper, driveToCuttingStartPosition, CAT_CUTTING_START_POSITION - 10000);</span></div><div class="line">        </div><div class="line">        <span class="comment">//  lower head to record surface: start when reached start position of start groove</span></div><div class="line">        <a class="code" href="device_scheduler_8h.html#ae5841fd44d6e01bbac6e04706ff5c9db">scheduledTask</a> lowerHeadLeftForCutting = scheduler-&gt;device[headLeftServo]-&gt;addTask(<a name="a63"></a><a class="code" href="device_scheduler_8h.html#a6515948ad08e970855266844e29033f7">HEAD_LEFT_CUT_POSITION</a>, <a name="a64"></a><a class="code" href="device_scheduler_8h.html#a946d3c3e74d9b69c6c95a88ae5d626b6">LIFT_SPEED_FAST</a>, <a name="a65"></a><a class="code" href="device_scheduler_8h.html#a8a0781daa7bd04dc93c4f78138fed27f">LIFT_ACCEL_FAST</a>, <a class="code" href="device_scheduler_8h.html#a8a0781daa7bd04dc93c4f78138fed27f">LIFT_ACCEL_FAST</a>);</div><div class="line">        scheduler-&gt;device[headLeftServo]-&gt;task[lowerHeadLeftForCutting]-&gt;startAfterCompletionOf(catStepper, driveToCuttingStartPosition);</div><div class="line">        </div><div class="line">        <span class="comment">//  lower head to record surface: start when reached start position of start groove</span></div><div class="line">        <a class="code" href="device_scheduler_8h.html#ae5841fd44d6e01bbac6e04706ff5c9db">scheduledTask</a> lowerHeadRightForCutting = scheduler-&gt;device[headRightServo]-&gt;addTask(<a name="a66"></a><a class="code" href="device_scheduler_8h.html#a208ea4d73b8e90444c2e934b3935b206">HEAD_RIGHT_CUT_POSITION</a>, <a name="a67"></a><a class="code" href="device_scheduler_8h.html#a1605a33747d6a8b2ae09aa98ac85f119">LIFT_SPEED_VERY_SLOW</a>, <a name="a68"></a><a class="code" href="device_scheduler_8h.html#ae193785e7d591cca99c15b1e67db7727">LIFT_ACCEL_VERY_SLOW</a>, <a class="code" href="device_scheduler_8h.html#ae193785e7d591cca99c15b1e67db7727">LIFT_ACCEL_VERY_SLOW</a>);</div><div class="line">        scheduler-&gt;device[headRightServo]-&gt;task[lowerHeadRightForCutting]-&gt;startAfterCompletionOf(catStepper, driveToCuttingStartPosition);</div><div class="line">        <span class="comment">//            scheduler-&gt;device[headRightServo]-&gt;task[lowerHeadRightForCutting]-&gt;stopDynamicallyBySensor(A5, 600, 460, 0.6, SKIP_APPROXIMATION_PRECISE);</span></div><div class="line">        </div><div class="line">        <a class="code" href="device_scheduler_8h.html#ae5841fd44d6e01bbac6e04706ff5c9db">scheduledTask</a> makeStartGroove = scheduler-&gt;device[catStepper]-&gt;addTask(catCuttingEndPosition, catMotorSpeed_startGroove, <a name="a69"></a><a class="code" href="device_scheduler_8h.html#aed8df0605d02dda82bc95a54f06caf6b">CAT_ACCEL_SLOW</a>, <a class="code" href="device_scheduler_8h.html#aed8df0605d02dda82bc95a54f06caf6b">CAT_ACCEL_SLOW</a>);</div><div class="line">        <span class="comment">//            scheduler-&gt;device[catStepper]-&gt;task[makeStartGroove]-&gt;startAfterCompletionOf(headRightServo, lowerHeadRightForCutting);</span></div><div class="line">        scheduler-&gt;device[catStepper]-&gt;task[makeStartGroove]-&gt;startAfterCompletionOf(headLeftServo, lowerHeadLeftForCutting);</div><div class="line">        scheduler-&gt;device[catStepper]-&gt;task[makeStartGroove]-&gt;switchToNextTaskByTriggerpositionOf(catStepper, makeStartGroove, catSongStartPosition);</div><div class="line">        </div><div class="line">        <a class="code" href="device_scheduler_8h.html#ae5841fd44d6e01bbac6e04706ff5c9db">scheduledTask</a> makeMainGroove = scheduler-&gt;device[catStepper]-&gt;addTask(catCuttingEndPosition, catMotorSpeed_song, <a class="code" href="device_scheduler_8h.html#aed8df0605d02dda82bc95a54f06caf6b">CAT_ACCEL_SLOW</a>, <a class="code" href="device_scheduler_8h.html#aed8df0605d02dda82bc95a54f06caf6b">CAT_ACCEL_SLOW</a>);</div><div class="line">        scheduler-&gt;device[catStepper]-&gt;task[makeMainGroove]-&gt;switchToNextTaskByTriggerpositionOf(catStepper, makeMainGroove, catSongEndPosition);</div><div class="line">        </div><div class="line">        <a class="code" href="device_scheduler_8h.html#ae5841fd44d6e01bbac6e04706ff5c9db">scheduledTask</a> makeEndGroove = scheduler-&gt;device[catStepper]-&gt;addTask(catCuttingEndPosition, catMotorSpeed_endGroove, <a name="a70"></a><a class="code" href="device_scheduler_8h.html#ac6c925ca192c398919ca576e6cfdb10b">CAT_ACCEL_NORMAL</a>, <a class="code" href="device_scheduler_8h.html#ac6c925ca192c398919ca576e6cfdb10b">CAT_ACCEL_NORMAL</a>);</div><div class="line">        </div><div class="line">        <a class="code" href="device_scheduler_8h.html#ae5841fd44d6e01bbac6e04706ff5c9db">scheduledTask</a> liftHeadLeftAfterCutting = scheduler-&gt;device[headLeftServo]-&gt;addTask(<a name="a71"></a><a class="code" href="device_scheduler_8h.html#a7856a5bde48e50dfa1dde0a9fa675876">HEAD_LEFT_TOP_POSITION</a>, <a class="code" href="device_scheduler_8h.html#a946d3c3e74d9b69c6c95a88ae5d626b6">LIFT_SPEED_FAST</a>, <a name="a72"></a><a class="code" href="device_scheduler_8h.html#a3aaf2b341424c8529c4d61e4dce527d0">LIFT_ACCEL_SLOW</a>, <a class="code" href="device_scheduler_8h.html#a3aaf2b341424c8529c4d61e4dce527d0">LIFT_ACCEL_SLOW</a>);</div><div class="line">        scheduler-&gt;device[headLeftServo]-&gt;task[liftHeadLeftAfterCutting]-&gt;startAfterCompletionOf(catStepper, makeEndGroove);</div><div class="line">        </div><div class="line">        scheduler-&gt;device[tableStepper]-&gt;task[turnTheTable]-&gt;stopAfterCompletionOf(headLeftServo, liftHeadLeftAfterCutting, <a class="code" href="device_scheduler_8h.html#a82b311bea6cf44d0e38e302ad9457af9a912a5244b1552dfb596bfbc3bb124bc0">STOP_NORMAL</a>);</div><div class="line">        </div><div class="line">        <a class="code" href="device_scheduler_8h.html#ae5841fd44d6e01bbac6e04706ff5c9db">scheduledTask</a> liftHeadRightAfterCutting = scheduler-&gt;device[headRightServo]-&gt;addTask(<a name="a73"></a><a class="code" href="device_scheduler_8h.html#a8f93c59917baa904ed65b0914bb4cbae">HEAD_RIGHT_TOP_POSITION</a>, <a class="code" href="device_scheduler_8h.html#a946d3c3e74d9b69c6c95a88ae5d626b6">LIFT_SPEED_FAST</a>, <a class="code" href="device_scheduler_8h.html#a3aaf2b341424c8529c4d61e4dce527d0">LIFT_ACCEL_SLOW</a>, <a class="code" href="device_scheduler_8h.html#a3aaf2b341424c8529c4d61e4dce527d0">LIFT_ACCEL_SLOW</a>);</div><div class="line">        scheduler-&gt;device[headRightServo]-&gt;task[liftHeadRightAfterCutting]-&gt;startAfterCompletionOf(headLeftServo, liftHeadLeftAfterCutting);</div><div class="line">        </div><div class="line">        <a class="code" href="device_scheduler_8h.html#ae5841fd44d6e01bbac6e04706ff5c9db">scheduledTask</a> driveToParkPosition = scheduler-&gt;device[catStepper]-&gt;addTask(<a name="a74"></a><a class="code" href="device_scheduler_8h.html#ae355c5ef387f945f6d24fbb4f09baf1d">CAT_PARK_POSITION</a>, <a class="code" href="device_scheduler_8h.html#a95580629d12e0a7bed5b1e0ff8fa755b">CAT_SPEED_HIGH</a>, <a class="code" href="device_scheduler_8h.html#aa607ecf76abb41572956668e9ce39bc4">CAT_ACCEL_HIGH</a>, <a class="code" href="device_scheduler_8h.html#aa607ecf76abb41572956668e9ce39bc4">CAT_ACCEL_HIGH</a>);</div><div class="line">        scheduler-&gt;device[catStepper]-&gt;task[driveToParkPosition]-&gt;startAfterCompletionOf(headLeftServo, liftHeadLeftAfterCutting);</div><div class="line">        scheduler-&gt;device[catStepper]-&gt;task[driveToParkPosition]-&gt;stopByButton(<a class="code" href="device_scheduler_8h.html#a4aa4f72b5f68cf77a095aafad97d97dd">CAT_PARK_BUTTON</a>, HIGH, <a class="code" href="device_scheduler_8h.html#a82b311bea6cf44d0e38e302ad9457af9a912a5244b1552dfb596bfbc3bb124bc0">STOP_NORMAL</a>);</div><div class="line">        </div><div class="line">        </div><div class="line">        scheduler-&gt;controlButton[songEndButton]-&gt;evokeTaskJumpToTask(catStepper, makeMainGroove, <a name="a75"></a><a class="code" href="device_scheduler_8h.html#a46e69191c64a1194a22bc13d7e77263fafd0edba01824bda61f8fcb0593c9019a">STOP_AND_SWITCH</a>, makeEndGroove);</div><div class="line">        </div><div class="line">        scheduler-&gt;controlButton[songCancelButton]-&gt;evokeTaskJumpToTask(catStepper, makeStartGroove, <a class="code" href="device_scheduler_8h.html#a46e69191c64a1194a22bc13d7e77263fafd0edba01824bda61f8fcb0593c9019a">STOP_AND_SWITCH</a>, driveToParkPosition);</div><div class="line">        scheduler-&gt;controlButton[songCancelButton]-&gt;evokeTaskJumpToTask(catStepper, makeMainGroove, <a class="code" href="device_scheduler_8h.html#a46e69191c64a1194a22bc13d7e77263fafd0edba01824bda61f8fcb0593c9019a">STOP_AND_SWITCH</a>, driveToParkPosition);</div><div class="line">        scheduler-&gt;controlButton[songCancelButton]-&gt;evokeTaskJump(catStepper, makeEndGroove, <a name="a76"></a><a class="code" href="device_scheduler_8h.html#a46e69191c64a1194a22bc13d7e77263fa679ee5320d66c8322e310daeb2ee99b8">STOP</a>);</div><div class="line">        </div><div class="line">        scheduler-&gt;getAllControlButtons();</div><div class="line">        scheduler-&gt;getAllActions();</div><div class="line">        </div><div class="line">        <span class="comment">// ============================================================================================================================</span></div><div class="line">        <span class="comment">// ============================================================================================================================</span></div><div class="line">        <span class="comment">// ============================================================================================================================</span></div><div class="line">        </div><div class="line">        </div><div class="line">        scheduler-&gt;reviewTasks();</div><div class="line">        </div><div class="line">        scheduler-&gt;getAllTasks();</div><div class="line">        </div><div class="line">        freeRam();</div><div class="line">        </div><div class="line">        </div><div class="line">        </div><div class="line">        </div><div class="line">        delay(2000);</div><div class="line">        </div><div class="line">        scheduler-&gt;run();</div><div class="line">        </div><div class="line">        scheduler-&gt;deleteAllTasks();</div><div class="line">        scheduler-&gt;deleteAllActions();</div></div><!-- fragment --><div class="fragment"><div class="line">///</div><div class="line">/// @mainpage   deviceScheduler</div><div class="line">///</div><div class="line">/// @details    schedule and drive stepper-, servo- and other devices</div><div class="line">/// @n</div><div class="line">/// @n</div><div class="line">/// @n @a       Developed with [embedXcode+](http://embedXcode.weebly.com)</div><div class="line">///</div><div class="line">/// @author     little Ikarus</div><div class="line">/// @author     ___FULLUSERNAME___</div><div class="line">/// @date       01.06.15 12:52</div><div class="line">/// @version    &lt;#version#&gt;</div><div class="line">///</div><div class="line">/// @copyright  (c) little Ikarus, 2015</div><div class="line">/// @copyright  License</div><div class="line">///</div><div class="line">/// @see        ReadMe.txt for references</div><div class="line">///</div><div class="line"></div><div class="line"></div><div class="line">///</div><div class="line">/// @file       deviceScheduler.ino</div><div class="line">/// @brief      Main sketch</div><div class="line">///</div><div class="line">/// @details    &lt;#details#&gt;</div><div class="line">/// @n @a       Developed with [embedXcode+](http://embedXcode.weebly.com)</div><div class="line">///</div><div class="line">/// @author     little Ikarus</div><div class="line">/// @author     ___FULLUSERNAME___</div><div class="line">/// @date       01.06.15 12:52</div><div class="line">/// @version    &lt;#version#&gt;</div><div class="line">///</div><div class="line">/// @copyright  (c) little Ikarus, 2015</div><div class="line">/// @copyright  License</div><div class="line">///</div><div class="line">/// @see        ReadMe.txt for references</div><div class="line">/// @n</div><div class="line">///</div><div class="line"></div><div class="line"></div><div class="line">#include &lt;Arduino.h&gt;</div><div class="line"></div><div class="line">// Include application, user and local libraries</div><div class="line">#include &lt;Servo.h&gt;</div><div class="line"></div><div class="line">#include &quot;deviceScheduler.h&quot;</div><div class="line">#include &quot;CCDeviceScheduler.h&quot;</div><div class="line"></div><div class="line">//#include &lt;Streaming.h&gt;</div><div class="line">#include &lt;malloc.h&gt;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">// Prototypes</div><div class="line">void freeRam ();</div><div class="line"></div><div class="line"></div><div class="line">// Define variables and constants</div><div class="line">unsigned long catSongStartPosition, catSongEndPosition, catCuttingEndPosition;</div><div class="line">float catMotorSpeed_startGroove, catMotorSpeed_song, catMotorSpeed_endGroove;</div><div class="line">unsigned long grooves_all;</div><div class="line">float turnTableStepperSpeed;</div><div class="line"></div><div class="line">extern char _end;</div><div class="line">extern &quot;C&quot; char *sbrk(int i);</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">// ------------- debug --------------------------------------------------------------------------------------------------</div><div class="line">//static unsigned char DEVICESCHEDULER_VERBOSE = DEVICESCHEDULER_SHOW_TAB_VIEW DEVICESCHEDULER_BASICPUTPUT | DEVICESCHEDULER_MEMORYDEBUG;</div><div class="line">//static unsigned char DEVICESCHEDULER_VERBOSE = DEVICESCHEDULER_SHOW_TASK_VIEW | DEVICESCHEDULER_BASICPUTPUT | DEVICESCHEDULER_MEMORYDEBUG;</div><div class="line">//static unsigned char DEVICESCHEDULER_VERBOSE = 0;</div><div class="line"></div><div class="line">// ------------- globals --------------------------------------------------------------------------------------------------</div><div class="line">CCDeviceScheduler *scheduler;</div><div class="line"></div><div class="line">// ------------- prototypes --------------------------------------------------------------------------------------------------</div><div class="line">void setup();</div><div class="line">void calculateCuttingParameters();</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">void loop() {</div><div class="line">    </div><div class="line">    Serial.println(), Serial.println(), Serial.println();</div><div class="line">    for (int i = 0; i &lt; 56; i++) Serial.print(F(&quot;#&quot;));</div><div class="line">    Serial.println(), Serial.println(), Serial.println();</div><div class="line">    </div><div class="line">    freeRam();</div><div class="line">    /* create a scheduler object */</div><div class="line">    scheduler = new CCDeviceScheduler;</div><div class="line">    </div><div class="line">    freeRam();</div><div class="line">    </div><div class="line">    // ============================================================================================================================</div><div class="line">    // ============= devices ======================================================================================================</div><div class="line">    // ============================================================================================================================</div><div class="line">    schedulerDevice liftServo = scheduler-&gt;addServo(SERVO_LIFT_NAME,</div><div class="line">                                                  SERVO_LIFT_PIN,</div><div class="line">                                                  SERVO_LIFT_MIN_POSITION,</div><div class="line">                                                  SERVO_LIFT_MAX_POSITION,</div><div class="line">                                                  LIFT_PARK_POSITION);</div><div class="line">    freeRam();</div><div class="line">    schedulerDevice turnServo = scheduler-&gt;addServo(SERVO_TURN_NAME,</div><div class="line">                                                  SERVO_TURN_PIN,</div><div class="line">                                                  SERVO_TURN_MIN_POSITION,</div><div class="line">                                                  SERVO_TURN_MAX_POSITION,</div><div class="line">                                                  TURN_PARK_POSITION);</div><div class="line">    freeRam();</div><div class="line">    schedulerDevice headLeftServo = scheduler-&gt;addServo(SERVO_HEAD_LEFT_NAME,</div><div class="line">                                                      SERVO_HEAD_LEFT_PIN,</div><div class="line">                                                      SERVO_HEAD_LEFT_MIN_POSITION,</div><div class="line">                                                      SERVO_HEAD_LEFT_MAX_POSITION,</div><div class="line">                                                      HEAD_LEFT_PARK_POSITION);</div><div class="line">    freeRam();</div><div class="line">    schedulerDevice headRightServo = scheduler-&gt;addServo(SERVO_HEAD_RIGHT_NAME,</div><div class="line">                                                       SERVO_HEAD_RIGHT_PIN,</div><div class="line">                                                       SERVO_HEAD_RIGHT_MIN_POSITION,</div><div class="line">                                                       SERVO_HEAD_RIGHT_MAX_POSITION,</div><div class="line">                                                       HEAD_RIGHT_PARK_POSITION);</div><div class="line">    freeRam();</div><div class="line">    schedulerDevice stockStepper = scheduler-&gt;addStepper_A4988(STEPPER_STOCK_NAME,</div><div class="line">                                                       STEPPER_STOCK_STEP_PIN,</div><div class="line">                                                       STEPPER_STOCK_DIR_PIN,</div><div class="line">                                                       STEPPER_STOCK_ENABLE_PIN,</div><div class="line">                                                       STEPPER_STOCK_HIGHEST_STEPPINGMODE,</div><div class="line">                                                       STEPPER_STOCK_STEPMODECODES,</div><div class="line">                                                       STEPPER_STOCK_MICROSTEPPINS,</div><div class="line">                                                       STEPPER_STOCK_STEPS_PER_ROTATION);</div><div class="line"></div><div class="line">    schedulerDevice tableStepper = scheduler-&gt;addStepper_A4988(STEPPER_TABLE_NAME,</div><div class="line">                                                         STEPPER_TABLE_STEP_PIN,</div><div class="line">                                                         STEPPER_TABLE_DIR_PIN,</div><div class="line">                                                         STEPPER_TABLE_ENABLE_PIN,</div><div class="line">                                                         STEPPER_TABLE_HIGHEST_STEPPINGMODE,</div><div class="line">                                                         STEPPER_TABLE_STEPMODECODES,</div><div class="line">                                                         STEPPER_TABLE_MICROSTEPPINS,</div><div class="line">                                                         STEPPER_TABLE_STEPS_PER_ROTATION);</div><div class="line">    </div><div class="line">    schedulerDevice catStepper = scheduler-&gt;addStepper_TMC260(STEPPER_CAT_NAME,</div><div class="line">                                                              STEPPER_CAT_STEP_PIN,</div><div class="line">                                                              STEPPER_CAT_DIR_PIN,</div><div class="line">                                                              STEPPER_CAT_ENABLE_PIN,</div><div class="line">                                                              STEPPER_CAT_CHIPSELECT_PIN,</div><div class="line">                                                              STEPPER_CAT_CURRENT,</div><div class="line">                                                              STEPPER_CAT_STEPS_PER_ROTATION);</div><div class="line"></div><div class="line">    freeRam();</div><div class="line">    schedulerDevice tableDrive = scheduler-&gt;addDcController(TABLEDRIVE_NAME, TABLEDRIVE_PIN, TABLEDRIVE_ACTIV);</div><div class="line">    freeRam();</div><div class="line">    </div><div class="line">    </div><div class="line">    scheduler-&gt;getAllDevices();</div><div class="line"></div><div class="line">    schedulerControlButton songEndButton = scheduler-&gt;addControlButton(SONG_END_BUTTON_NAME, SONG_END_PIN, SONG_END_ACTIV);</div><div class="line">    schedulerControlButton songCancelButton = scheduler-&gt;addControlButton(SONG_CANCEL_BUTTON_NAME, SONG_CANCEL_PIN, SONG_CANCEL_ACTIV);</div><div class="line">    </div><div class="line">    scheduler-&gt;getAllControlButtons();</div><div class="line">    </div><div class="line">    </div><div class="line">    </div><div class="line">    for (;;) {</div><div class="line">        </div><div class="line">        // ============================================================================================================================</div><div class="line">        // ============= moves ========================================================================================================</div><div class="line">        // ============================================================================================================================</div><div class="line">        </div><div class="line">        // ########## scheduledTask addTaskWithStartDelay(float target, unsigned long startDelay, float velocity, float acceleration, float deceleration);</div><div class="line">        // ########## scheduledTask addTask(float target, float velocity, float acceleration, float deceleration) {</div><div class="line">        </div><div class="line">        </div><div class="line">        // ########## startByDate(unsigned long startTime)</div><div class="line">        // ########## startByButton(unsigned char startButton, boolean startButtonState)</div><div class="line">        // ########## startByTriggerpositionOf(schedulerDevice startTriggerDevice, scheduledTask startTriggerTask, signed long startTriggerPosition)</div><div class="line">        </div><div class="line">        // ########## setDisposeAfterTask(unsigned char stopTriggerDevice, unsigned char stopTriggerTask)</div><div class="line">        </div><div class="line">        // ########## switchToNextTaskByDate(unsigned long startTime);</div><div class="line">        // ########## switchToNextTaskByButton(unsigned char startButton, boolean startButtonState);</div><div class="line">        // ########## switchToNextTaskByTriggerpositionOf(schedulerDevice switchingTriggerDevice, scheduledTask switchingTriggerTask, signed long startTriggerPosition);</div><div class="line">        </div><div class="line">        // ########## stopByTimeout(unsigned long timeout, stoppingMode stopping)</div><div class="line">        // ########## stopByButton(unsigned char stopButton, boolean stopButtonState, stoppingMode stopping)</div><div class="line">        // ########## stopByTriggerpositionOf(schedulerDevice stopTriggerDevice, scheduledTask stopTriggerTask, signed long stopTriggerPosition, stoppingMode stopping)</div><div class="line">        </div><div class="line">        //  stopping:  STOP_IMMEDIATELY, STOP_NORMAL</div><div class="line">        </div><div class="line">        // ============================================================================================================================</div><div class="line">        // ============================================================================================================================</div><div class="line">        // ============================================================================================================================</div><div class="line">        </div><div class="line">        </div><div class="line">        </div><div class="line">        scheduler-&gt;device[catStepper]-&gt;currentPosition = 0;</div><div class="line"></div><div class="line">        </div><div class="line">        Serial.println(&quot;................................. initialisation .................................&quot;);</div><div class="line">        </div><div class="line">        </div><div class="line">        scheduledTask initCatStepper = scheduler-&gt;device[catStepper]-&gt;addTask(-400000, CAT_SPEED_VERY_HIGH, CAT_ACCEL_VERY_HIGH, CAT_ACCEL_VERY_HIGH);</div><div class="line">        scheduler-&gt;device[catStepper]-&gt;task[initCatStepper]-&gt;startByDate(100);</div><div class="line">        scheduler-&gt;device[catStepper]-&gt;task[initCatStepper]-&gt;stopByButton(CAT_PARK_BUTTON, HIGH, STOP_NORMAL);</div><div class="line">        </div><div class="line">        scheduler-&gt;reviewTasks();</div><div class="line">        scheduler-&gt;getAllTasks();</div><div class="line"></div><div class="line">        scheduler-&gt;run();</div><div class="line">        </div><div class="line">        scheduler-&gt;deleteAllTasks();</div><div class="line">        scheduler-&gt;deleteAllActions();</div><div class="line">        </div><div class="line">        </div><div class="line">        Serial.println(&quot;...................................... done ......................................&quot;);</div><div class="line"></div><div class="line">        </div><div class="line">        scheduler-&gt;device[catStepper]-&gt;currentPosition = 0;</div><div class="line">        scheduler-&gt;device[tableStepper]-&gt;currentPosition = 0;</div><div class="line">        </div><div class="line">        if (digitalRead(NORMAL_CUTTING) == HIGH) {</div><div class="line">            </div><div class="line">            freeRam();</div><div class="line">            </div><div class="line">            //  move to start groove:</div><div class="line">            scheduledTask driveToCuttingStartPosition = scheduler-&gt;device[catStepper]-&gt;addTask(CAT_CUTTING_START_POSITION, CAT_SPEED_HIGH, CAT_ACCEL_HIGH, CAT_ACCEL_HIGH);</div><div class="line">            scheduler-&gt;device[catStepper]-&gt;task[driveToCuttingStartPosition]-&gt;startByDate(100);</div><div class="line">//            scheduler-&gt;device[catStepper]-&gt;task[driveToCuttingStartPosition]-&gt;stopByButton(CAT_END_BUTTON, HIGH, STOP_NORMAL);</div><div class="line">            </div><div class="line">            //  turn the table:</div><div class="line">            scheduledTask turnTheTable = scheduler-&gt;device[tableStepper]-&gt;addTask(grooves_all * 3600, turnTableStepperSpeed, TABLE_STEP_ACCEL, TABLE_STEP_ACCEL);</div><div class="line">            scheduler-&gt;device[tableStepper]-&gt;task[turnTheTable]-&gt;startAfterCompletionOf(catStepper, driveToCuttingStartPosition);</div><div class="line">//            scheduler-&gt;device[tableDrive]-&gt;task[turnTheTable]-&gt;startByTriggerpositionOf(catStepper, driveToCuttingStartPosition, CAT_CUTTING_START_POSITION - 10000);</div><div class="line">            </div><div class="line">            //  lower head to record surface: start when reached start position of start groove</div><div class="line">            scheduledTask lowerHeadLeftForCutting = scheduler-&gt;device[headLeftServo]-&gt;addTask(HEAD_LEFT_CUT_POSITION, LIFT_SPEED_FAST, LIFT_ACCEL_FAST, LIFT_ACCEL_FAST);</div><div class="line">            scheduler-&gt;device[headLeftServo]-&gt;task[lowerHeadLeftForCutting]-&gt;startAfterCompletionOf(catStepper, driveToCuttingStartPosition);</div><div class="line">            </div><div class="line">            //  lower head to record surface: start when reached start position of start groove</div><div class="line">            scheduledTask lowerHeadRightForCutting = scheduler-&gt;device[headRightServo]-&gt;addTask(HEAD_RIGHT_CUT_POSITION, LIFT_SPEED_VERY_SLOW, LIFT_ACCEL_VERY_SLOW, LIFT_ACCEL_VERY_SLOW);</div><div class="line">            scheduler-&gt;device[headRightServo]-&gt;task[lowerHeadRightForCutting]-&gt;startAfterCompletionOf(catStepper, driveToCuttingStartPosition);</div><div class="line">//            scheduler-&gt;device[headRightServo]-&gt;task[lowerHeadRightForCutting]-&gt;stopDynamicallyBySensor(A5, 600, 460, 0.6, SKIP_APPROXIMATION_PRECISE);</div><div class="line">            </div><div class="line">            scheduledTask makeStartGroove = scheduler-&gt;device[catStepper]-&gt;addTask(catCuttingEndPosition, catMotorSpeed_startGroove, CAT_ACCEL_SLOW, CAT_ACCEL_SLOW);</div><div class="line">//            scheduler-&gt;device[catStepper]-&gt;task[makeStartGroove]-&gt;startAfterCompletionOf(headRightServo, lowerHeadRightForCutting);</div><div class="line">            scheduler-&gt;device[catStepper]-&gt;task[makeStartGroove]-&gt;startAfterCompletionOf(headLeftServo, lowerHeadLeftForCutting);</div><div class="line">            scheduler-&gt;device[catStepper]-&gt;task[makeStartGroove]-&gt;switchToNextTaskByTriggerpositionOf(catStepper, makeStartGroove, catSongStartPosition);</div><div class="line">            </div><div class="line">            scheduledTask makeMainGroove = scheduler-&gt;device[catStepper]-&gt;addTask(catCuttingEndPosition, catMotorSpeed_song, CAT_ACCEL_SLOW, CAT_ACCEL_SLOW);</div><div class="line">            scheduler-&gt;device[catStepper]-&gt;task[makeMainGroove]-&gt;switchToNextTaskByTriggerpositionOf(catStepper, makeMainGroove, catSongEndPosition);</div><div class="line">            </div><div class="line">            scheduledTask makeEndGroove = scheduler-&gt;device[catStepper]-&gt;addTask(catCuttingEndPosition, catMotorSpeed_endGroove, CAT_ACCEL_NORMAL, CAT_ACCEL_NORMAL);</div><div class="line">            </div><div class="line">            scheduledTask liftHeadLeftAfterCutting = scheduler-&gt;device[headLeftServo]-&gt;addTask(HEAD_LEFT_TOP_POSITION, LIFT_SPEED_FAST, LIFT_ACCEL_SLOW, LIFT_ACCEL_SLOW);</div><div class="line">            scheduler-&gt;device[headLeftServo]-&gt;task[liftHeadLeftAfterCutting]-&gt;startAfterCompletionOf(catStepper, makeEndGroove);</div><div class="line">            </div><div class="line">            scheduler-&gt;device[tableStepper]-&gt;task[turnTheTable]-&gt;stopAfterCompletionOf(headLeftServo, liftHeadLeftAfterCutting, STOP_NORMAL);</div><div class="line">            </div><div class="line">            scheduledTask liftHeadRightAfterCutting = scheduler-&gt;device[headRightServo]-&gt;addTask(HEAD_RIGHT_TOP_POSITION, LIFT_SPEED_FAST, LIFT_ACCEL_SLOW, LIFT_ACCEL_SLOW);</div><div class="line">            scheduler-&gt;device[headRightServo]-&gt;task[liftHeadRightAfterCutting]-&gt;startAfterCompletionOf(headLeftServo, liftHeadLeftAfterCutting);</div><div class="line">            </div><div class="line">            scheduledTask driveToParkPosition = scheduler-&gt;device[catStepper]-&gt;addTask(CAT_PARK_POSITION, CAT_SPEED_HIGH, CAT_ACCEL_HIGH, CAT_ACCEL_HIGH);</div><div class="line">            scheduler-&gt;device[catStepper]-&gt;task[driveToParkPosition]-&gt;startAfterCompletionOf(headLeftServo, liftHeadLeftAfterCutting);</div><div class="line">            scheduler-&gt;device[catStepper]-&gt;task[driveToParkPosition]-&gt;stopByButton(CAT_PARK_BUTTON, HIGH, STOP_NORMAL);</div><div class="line">            </div><div class="line">            </div><div class="line">            scheduler-&gt;controlButton[songEndButton]-&gt;evokeTaskJumpToTask(catStepper, makeMainGroove, STOP_AND_SWITCH, makeEndGroove);</div><div class="line">            </div><div class="line">            scheduler-&gt;controlButton[songCancelButton]-&gt;evokeTaskJumpToTask(catStepper, makeStartGroove, STOP_AND_SWITCH, driveToParkPosition);</div><div class="line">            scheduler-&gt;controlButton[songCancelButton]-&gt;evokeTaskJumpToTask(catStepper, makeMainGroove, STOP_AND_SWITCH, driveToParkPosition);</div><div class="line">            scheduler-&gt;controlButton[songCancelButton]-&gt;evokeTaskJump(catStepper, makeEndGroove, STOP);</div><div class="line"></div><div class="line">            scheduler-&gt;getAllControlButtons();</div><div class="line">            scheduler-&gt;getAllActions();</div><div class="line">            </div><div class="line">            // ============================================================================================================================</div><div class="line">            // ============================================================================================================================</div><div class="line">            // ============================================================================================================================</div><div class="line">            </div><div class="line">            </div><div class="line">           scheduler-&gt;reviewTasks();</div><div class="line">            </div><div class="line">            scheduler-&gt;getAllTasks();</div><div class="line">            </div><div class="line">            freeRam();</div><div class="line">            </div><div class="line">            </div><div class="line">            </div><div class="line">             </div><div class="line">            delay(2000);</div><div class="line">            </div><div class="line">            scheduler-&gt;run();</div><div class="line">            </div><div class="line">            scheduler-&gt;deleteAllTasks();</div><div class="line">            scheduler-&gt;deleteAllActions();</div><div class="line"></div><div class="line">        } else {</div><div class="line">            </div><div class="line">            //  move to start groove:</div><div class="line">            scheduledTask driveToCuttingStartPositionMan = scheduler-&gt;device[catStepper]-&gt;addTask(CAT_CUTTING_START_POSITION, 4800, 3200, 3200);</div><div class="line">            scheduler-&gt;device[catStepper]-&gt;task[driveToCuttingStartPositionMan]-&gt;startByDate(100);</div><div class="line">            scheduler-&gt;device[catStepper]-&gt;task[driveToCuttingStartPositionMan]-&gt;stopByButton(CAT_END_BUTTON, HIGH, STOP_NORMAL);</div><div class="line">            </div><div class="line">            scheduler-&gt;reviewTasks();</div><div class="line">            scheduler-&gt;run();</div><div class="line">            scheduler-&gt;deleteAllTasks();</div><div class="line">            </div><div class="line">            while (digitalRead(START_CUTTING_BUTTON) == HIGH) {</div><div class="line">                if (digitalRead(CAT_FWD) == LOW) {</div><div class="line">                    driveToCuttingStartPositionMan = scheduler-&gt;device[catStepper]-&gt;addTask(catCuttingEndPosition, 4800, 3200, 3200);</div><div class="line">                    scheduler-&gt;device[catStepper]-&gt;task[driveToCuttingStartPositionMan]-&gt;startByDate(10);</div><div class="line">                    scheduler-&gt;device[catStepper]-&gt;task[driveToCuttingStartPositionMan]-&gt;stopByButton(CAT_FWD, HIGH, STOP_NORMAL);</div><div class="line">                    </div><div class="line">                    scheduler-&gt;reviewTasks();</div><div class="line">                    scheduler-&gt;run();</div><div class="line">                    scheduler-&gt;deleteAllTasks();</div><div class="line">                }</div><div class="line">                if (digitalRead(CAT_RWD) == LOW) {</div><div class="line">                    driveToCuttingStartPositionMan = scheduler-&gt;device[catStepper]-&gt;addTask(CAT_PARK_POSITION, 4800, 3200, 3200);</div><div class="line">                    scheduler-&gt;device[catStepper]-&gt;task[driveToCuttingStartPositionMan]-&gt;startByDate(10);</div><div class="line">                    scheduler-&gt;device[catStepper]-&gt;task[driveToCuttingStartPositionMan]-&gt;stopByButton(CAT_RWD, HIGH, STOP_NORMAL);</div><div class="line">                    </div><div class="line">                    scheduler-&gt;reviewTasks();</div><div class="line">                    scheduler-&gt;run();</div><div class="line">                    scheduler-&gt;deleteAllTasks();</div><div class="line">                }</div><div class="line">            }</div><div class="line">            </div><div class="line">            </div><div class="line">            scheduler-&gt;reviewTasks();</div><div class="line">            scheduler-&gt;run();</div><div class="line">            scheduler-&gt;deleteAllTasks();</div><div class="line">        }</div><div class="line">            </div><div class="line">            </div><div class="line">        </div><div class="line">    }</div><div class="line">    </div><div class="line">    delay(2000);</div><div class="line">    </div><div class="line">    </div><div class="line">    Serial.println(&quot;delete scheduler&quot;);</div><div class="line">    </div><div class="line">    delete scheduler;</div><div class="line">    scheduler = NULL;</div><div class="line">    freeRam();</div><div class="line">    </div><div class="line">    delay(2000);</div><div class="line">    </div><div class="line">}</div><div class="line"></div><div class="line">void calculateCuttingParameters() {</div><div class="line">    </div><div class="line">    unsigned int songRange = CUTTING_RANGE - STARTGROOVE_RANGE - ENDGROOVE_RANGE_MIN;</div><div class="line">    unsigned int songGrooves = songRange / (float)SONGGROOVE_PITCH;</div><div class="line">    unsigned int playTime_seconds = songGrooves * 60 / RECORD_TURNS_PER_MINUTE;</div><div class="line">    unsigned int endGrooveRange = ENDGROOVE_RANGE_MIN;</div><div class="line">    </div><div class="line">    </div><div class="line">    </div><div class="line">    Serial.println();</div><div class="line">    Serial.println(&quot;################################################################################&quot;);</div><div class="line">    Serial.println(&quot;############################## CUTTING PARAMETERS ##############################&quot;);</div><div class="line">    Serial.println(&quot;################################################################################&quot;);</div><div class="line">    Serial.println();</div><div class="line"></div><div class="line">    Serial.print(&quot;groove pitch is set to &quot;);</div><div class="line">    Serial.print(SONGGROOVE_PITCH);</div><div class="line">    Serial.print(&quot;mm, start groove pitch is set to &quot;);</div><div class="line">    Serial.print(STARTGROOVE_PITCH);</div><div class="line">    Serial.print(&quot;mm, start groove width is set to &quot;);</div><div class="line">    Serial.print(STARTGROOVE_RANGE);</div><div class="line">    Serial.print(&quot;mm, end groove pitch is set to &quot;);</div><div class="line">    Serial.print(ENDGROOVE_PITCH);</div><div class="line">    Serial.print(&quot;mm, minimal end groove width is set to &quot;);</div><div class="line">    Serial.print(ENDGROOVE_RANGE_MIN);</div><div class="line">    Serial.println(&quot;mm&quot;);</div><div class="line">    Serial.print(&quot;max. song width: &quot;);</div><div class="line">    Serial.print(songRange);</div><div class="line">    Serial.print(&quot;mm, max. record grooves: &quot;);</div><div class="line">    Serial.print(songGrooves);</div><div class="line">    Serial.print(&quot;, max. playing time: &quot;);</div><div class="line">    Serial.print(playTime_seconds / 60);</div><div class="line">    Serial.print(&quot;:&quot;);</div><div class="line">    Serial.println(playTime_seconds % 60);</div><div class="line"></div><div class="line">    </div><div class="line">    if ((float)PLAYTIME_MINUTES * 60 &lt; playTime_seconds) {</div><div class="line">        songGrooves = PLAYTIME_MINUTES * RECORD_TURNS_PER_MINUTE;</div><div class="line">        songRange = songGrooves * SONGGROOVE_PITCH;</div><div class="line">        endGrooveRange = CUTTING_RANGE - songRange - STARTGROOVE_RANGE;</div><div class="line">        playTime_seconds = PLAYTIME_MINUTES * 60;</div><div class="line"></div><div class="line">        Serial.print(&quot;playing time is set to &quot;);</div><div class="line">        Serial.print(playTime_seconds / 60);</div><div class="line">        Serial.print(&quot;:&quot;);</div><div class="line">        Serial.print(playTime_seconds % 60);</div><div class="line">        Serial.print(&quot;, song width: &quot;);</div><div class="line">        Serial.print(songRange);</div><div class="line">        Serial.print(&quot;mm, record grooves: &quot;);</div><div class="line">        Serial.println(songGrooves);</div><div class="line">    } else {</div><div class="line">        Serial.println(&quot;desired playing time is too long, using maximal playing time!&quot;);</div><div class="line">    }</div><div class="line">    </div><div class="line"></div><div class="line">    grooves_all = STARTGROOVE_RANGE / (float)STARTGROOVE_PITCH + songGrooves + endGrooveRange / (float)ENDGROOVE_PITCH;</div><div class="line">    //    turnTableStepperSpeed = RECORD_TURNS_PER_MINUTE / 60.0 * TABLE_DRIVE_RATIO * 360.0;</div><div class="line">    turnTableStepperSpeed = 6 * RECORD_TURNS_PER_MINUTE * TABLE_DRIVE_RATIO;</div><div class="line">    </div><div class="line">    </div><div class="line">    float catSpeed_start_mmPerSecond = STARTGROOVE_PITCH * RECORD_TURNS_PER_MINUTE / 60.0;</div><div class="line">    float catMotorDegrees_start = 360.0 * STARTGROOVE_RANGE / SPIN_PITCH_M6 / (float)(CAT_DRIVE_RATIO);</div><div class="line">    catMotorSpeed_startGroove = 360.0 * catSpeed_start_mmPerSecond / SPIN_PITCH_M6 / (float)(CAT_DRIVE_RATIO);</div><div class="line"></div><div class="line">    float catSpeed_song_mmPerSecond = SONGGROOVE_PITCH * RECORD_TURNS_PER_MINUTE / 60.0;</div><div class="line">    float catMotorDegrees_song = 360.0 * songRange / SPIN_PITCH_M6 / (float)(CAT_DRIVE_RATIO);</div><div class="line">    catMotorSpeed_song = 360.0 * catSpeed_song_mmPerSecond / SPIN_PITCH_M6 / (float)(CAT_DRIVE_RATIO);</div><div class="line">    </div><div class="line">    float catSpeed_end_mmPerSecond = ENDGROOVE_PITCH * RECORD_TURNS_PER_MINUTE / 60.0;</div><div class="line">    float catMotorDegrees_end = 360.0 * endGrooveRange / SPIN_PITCH_M6 / (float)(CAT_DRIVE_RATIO);</div><div class="line">    catMotorSpeed_endGroove = 360.0 * catSpeed_end_mmPerSecond / SPIN_PITCH_M6 / (float)(CAT_DRIVE_RATIO);</div><div class="line">    </div><div class="line">    </div><div class="line">    catSongStartPosition = CAT_CUTTING_START_POSITION + catMotorDegrees_start;</div><div class="line">    catSongEndPosition = catSongStartPosition + catMotorDegrees_song;</div><div class="line">    catCuttingEndPosition = CAT_CUTTING_START_POSITION + CUTTING_RANGE * 360.0 / SPIN_PITCH_M6 / (float)(CAT_DRIVE_RATIO);</div><div class="line">    </div><div class="line"></div><div class="line">    Serial.print(&quot;Cutting the start groove: cutting progress [mm/sec]: &quot;);</div><div class="line">    Serial.print(catSpeed_start_mmPerSecond);</div><div class="line">    Serial.print(&quot;, degrees: &quot;);</div><div class="line">    Serial.print(catMotorDegrees_start);</div><div class="line">    Serial.print(&quot;, degrees per second: &quot;);</div><div class="line">    Serial.println(catMotorSpeed_startGroove);</div><div class="line">    </div><div class="line">    Serial.print(&quot;Cutting the song: cutting progress [mm/sec]: &quot;);</div><div class="line">    Serial.print(catSpeed_song_mmPerSecond);</div><div class="line">    Serial.print(&quot;, degrees: &quot;);</div><div class="line">    Serial.print(catMotorDegrees_song);</div><div class="line">    Serial.print(&quot;, degrees per second: &quot;);</div><div class="line">    Serial.println(catMotorSpeed_song);</div><div class="line"></div><div class="line">    Serial.print(&quot;Cutting the end groove: cutting progress [mm/sec]: &quot;);</div><div class="line">    Serial.print(catSpeed_end_mmPerSecond);</div><div class="line">    Serial.print(&quot;, degrees: &quot;);</div><div class="line">    Serial.print(catMotorDegrees_end);</div><div class="line">    Serial.print(&quot;, degrees per second: &quot;);</div><div class="line">    Serial.println(catMotorSpeed_endGroove);</div><div class="line"></div><div class="line">    Serial.println();</div><div class="line">    Serial.println(&quot;################################################################################&quot;);</div><div class="line">    Serial.println();</div><div class="line">    Serial.println();</div><div class="line">    </div><div class="line">}</div><div class="line"></div><div class="line">void setup() {</div><div class="line">    //    pinMode(CAT_FWD, INPUT_PULLUP);</div><div class="line">    //    pinMode(LOADING_BUTTON, INPUT_PULLUP);</div><div class="line">    //    pinMode(RECORD_AVAILABLE_BUTTON, INPUT_PULLUP);</div><div class="line">    //    pinMode(CAT_PARK_BUTTON, INPUT_PULLUP);</div><div class="line">    </div><div class="line">    </div><div class="line">    pinMode(NORMAL_CUTTING, INPUT_PULLUP);</div><div class="line">    pinMode(CAT_FWD, INPUT_PULLUP);</div><div class="line">    pinMode(CAT_RWD, INPUT_PULLUP);</div><div class="line">    pinMode(START_CUTTING_BUTTON, INPUT_PULLUP);</div><div class="line">    pinMode(STOP_CUTTING_BUTTON, INPUT_PULLUP);</div><div class="line">    </div><div class="line">    pinMode(CAT_PARK_BUTTON, INPUT_PULLUP);</div><div class="line">    pinMode(CAT_END_BUTTON, INPUT_PULLUP);</div><div class="line">    </div><div class="line">    pinMode(I_AM_LATE_LED, OUTPUT);</div><div class="line">    </div><div class="line">    Serial.begin(115200);</div><div class="line">    Serial.println(), Serial.println(), Serial.println();</div><div class="line">    Serial.println(), Serial.println(), Serial.println();</div><div class="line">        </div><div class="line">    Serial.println();</div><div class="line">    Serial.println();</div><div class="line">    Serial.println();</div><div class="line">    </div><div class="line">    calculateCuttingParameters();</div><div class="line">    </div><div class="line">}</div><div class="line"></div><div class="line">//int freeRam () {</div><div class="line">//    extern int __heap_start, *__brkval;</div><div class="line">//    int v;</div><div class="line">//    int fr = (int) &amp;v - (__brkval == 0 ? (int) &amp;__heap_start : (int) __brkval);</div><div class="line">//    Serial.print(&quot;Free ram: &quot;);</div><div class="line">//    Serial.println(fr);</div><div class="line">//}</div><div class="line"></div><div class="line"></div><div class="line">void freeRam() {</div><div class="line">    char *ramstart = (char *) 0x20070000;</div><div class="line">    char *ramend = (char *) 0x20088000;</div><div class="line">    char *heapend = sbrk(0);</div><div class="line">    register char * stack_ptr asm( &quot;sp&quot; );</div><div class="line">    struct mallinfo mi = mallinfo();</div><div class="line">    Serial.print(&quot;Ram used (bytes): dynamic: &quot;);</div><div class="line">    Serial.print(mi.uordblks);</div><div class="line">    Serial.print(&quot;  static:  &quot;);</div><div class="line">    Serial.print(&amp;_end - ramstart);</div><div class="line">    Serial.print(&quot;  stack:   &quot;);</div><div class="line">    Serial.print(ramend - stack_ptr);</div><div class="line">    Serial.print(&quot;, estimation free Ram: &quot;);</div><div class="line">    Serial.println(stack_ptr - heapend + mi.fordblks);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">//        unsigned char switchTableOn = scheduler-&gt;device[tableDrive]-&gt;addTask(TABLEDRIVE_ON, 0, 0, 0);</div><div class="line">//        scheduler-&gt;device[tableDrive]-&gt;setStartAfterCompletion(switchTableOn, headLeftServo, liftHeadFirstLeft);</div><div class="line">//        unsigned char switchTableOff = scheduler-&gt;device[tableDrive]-&gt;addTask(TABLEDRIVE_ACTIV, 0, 0, 0);</div><div class="line">//        scheduler-&gt;device[tableDrive]-&gt;startByDate(switchTableOff, 10000);</div><div class="line"></div><div class="line">//        unsigned char riseHead = scheduler-&gt;device[headLeftServo]-&gt;addTask(HEAD_LEFT_TOP_POSITION, LIFT_SPEED_SLOW, LIFT_ACCEL_SLOW, LIFT_ACCEL_SLOW);</div><div class="line">//        scheduler-&gt;device[headLeftServo]-&gt;setStartAfterCompletion(riseHead, headLeftServo, lowerHeadFirstLeft);</div><div class="line">//        scheduler-&gt;device[headLeftServo]-&gt;stopByTimeout(riseHead, 10000, true);</div><div class="line">//</div><div class="line">//        unsigned char lowerHead = scheduler-&gt;device[headLeftServo]-&gt;addTask(HEAD_LEFT_CUT_POSITION, LIFT_SPEED_SLOW, LIFT_ACCEL_SLOW, LIFT_ACCEL_SLOW);</div><div class="line">//        scheduler-&gt;device[headLeftServo]-&gt;setStartAfterCompletion(lowerHead, headLeftServo, riseHead);</div><div class="line">//        scheduler-&gt;device[headLeftServo]-&gt;stopDynamicallyBySensor(lowerHead, A5, 1000, 200, 0);</div><div class="line">//        scheduler-&gt;device[headLeftServo]-&gt;stopByTimeout(lowerHead, 10000, true);</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">//  unsigned char liftHeadFirstRight = scheduler-&gt;device[headRightServo]-&gt;addTask(HEAD_RIGHT_TOP_POSITION, LIFT_SPEED_SLOW, LIFT_ACCEL_SLOW, LIFT_ACCEL_SLOW);</div><div class="line">//  scheduler-&gt;device[headRightServo]-&gt;startByDate(liftHeadFirstRight, 100);</div><div class="line"></div><div class="line"></div><div class="line">// here may be a problem: preperation of next move before &#39;currentPosition&#39; set to 0</div><div class="line"></div><div class="line"></div><div class="line">/*</div><div class="line"> //  supply a new record from stock</div><div class="line"> unsigned char supplyNewRecord = scheduler-&gt;device[stockStepper]-&gt;addTask(36000L, STOCK_SUPPLY_RECORD_SPEED, STOCK_SUPPLY_RECORD_ACCEL, STOCK_SUPPLY_RECORD_ACCEL);</div><div class="line"> //        scheduler-&gt;device[stockStepper]-&gt;startByDate(supplyNewRecord, 100);</div><div class="line"> scheduler-&gt;device[stockStepper]-&gt;startByButton(supplyNewRecord, CAT_FWD, LOW);</div><div class="line"> scheduler-&gt;device[stockStepper]-&gt;stopByButton(supplyNewRecord, RECORD_AVAILABLE_BUTTON, HIGH, 0);</div><div class="line"> </div><div class="line"> //  lift grappler: start soon</div><div class="line"> unsigned char liftFromParkPosition = scheduler-&gt;device[liftServo]-&gt;addTask(LIFT_UP_POSITION, LIFT_SPEED_SLOW, LIFT_ACCEL_SLOW, NO_START_DELAY);</div><div class="line"> //        scheduler-&gt;device[liftServo]-&gt;startByDate(liftFromParkPosition, 100);</div><div class="line"> //        scheduler-&gt;device[turnServo]-&gt;startByButton(turnToStock, RECORD_AVAILABLE_BUTTON, HIGH);</div><div class="line"> freeRam();</div><div class="line"> </div><div class="line"> //  turn grappler to stock: start when lifting reached triggerPosition (LIFT_UP_TRIGGER_TURN)</div><div class="line"> unsigned char turnToStock = scheduler-&gt;device[turnServo]-&gt;addTask(TURN_STOCK_POSITION, TURN_SPEED_FAST, TURN_ACCEL_FAST, NO_START_DELAY);</div><div class="line"> scheduler-&gt;device[turnServo]-&gt;startByTriggerpositionOf(turnToStock, liftServo, liftFromParkPosition, LIFT_UP_TRIGGER_TURN);</div><div class="line"> freeRam();</div><div class="line"> </div><div class="line"> //  lower grappler to stock: start when turning reached trigger position (TURN_TO_STOCK_TRIGGER_LIFT)</div><div class="line"> unsigned char lowerToStock = scheduler-&gt;device[liftServo]-&gt;addTask(LIFT_STOCK_POSITION, LIFT_SPEED_FAST, LIFT_ACCEL_FAST, NO_START_DELAY);</div><div class="line"> //        scheduler-&gt;device[liftServo]-&gt;startByDate(lowerToStock, 3000);</div><div class="line"> scheduler-&gt;device[liftServo]-&gt;startByTriggerpositionOf(lowerToStock, turnServo, turnToStock, TURN_TO_STOCK_TRIGGER_LIFT);</div><div class="line"> freeRam();</div><div class="line"> </div><div class="line"> //         //  grip new record: start when grappler reached stock (LIFT_STOCK_POSITION)</div><div class="line"> //         unsigned char gripNewRecord = scheduler-&gt;device[vacuumSolenoid]-&gt;addTask(SOLENOID_DUTYCYCLE, SOLENOID_FREQUENCY, 0, 500);</div><div class="line"> //         scheduler-&gt;device[vacuumSolenoid]-&gt;startByTriggerpositionOf(gripNewRecord, liftServo, lowerToStock, LIFT_STOCK_POSITION);</div><div class="line"> //         freeRam();</div><div class="line"> </div><div class="line"> //  lift the new record: start with startDelay after stock was reached (LIFT_STOCK_POSITION)</div><div class="line"> unsigned char liftNewRecord = scheduler-&gt;device[liftServo]-&gt;addTask(LIFT_UP_POSITION, LIFT_SPEED_SLOW, LIFT_ACCEL_SLOW, 2666);</div><div class="line"> scheduler-&gt;device[liftServo]-&gt;startByTriggerpositionOf(liftNewRecord, liftServo, lowerToStock, LIFT_STOCK_POSITION);</div><div class="line"> freeRam();</div><div class="line"> </div><div class="line"> //  turn grappler to turn table: start when lifting reached triggerPosition (LIFT_UP_TRIGGER_TURN)</div><div class="line"> unsigned char turnRecordToTable = scheduler-&gt;device[turnServo]-&gt;addTask(TURN_TABLE_POSITION, TURN_SPEED_SLOW, TURN_ACCEL_SLOW, NO_START_DELAY);</div><div class="line"> scheduler-&gt;device[turnServo]-&gt;startByTriggerpositionOf(turnRecordToTable, liftServo, liftNewRecord, LIFT_FROM_STOCK_TRIGGER_TURN);</div><div class="line"> freeRam();</div><div class="line"> </div><div class="line"> //  lower grappler to turn table: start when turning reached trigger position (TURN_TO_TABLE_TRIGGER_LIFT)</div><div class="line"> unsigned char lowerRecordToTable = scheduler-&gt;device[liftServo]-&gt;addTask(LIFT_TABLE_POSITION, LIFT_SPEED_SLOW, LIFT_ACCEL_SLOW, NO_START_DELAY);</div><div class="line"> scheduler-&gt;device[liftServo]-&gt;startByTriggerpositionOf(lowerRecordToTable, turnServo, turnRecordToTable, TURN_TO_TABLE_TRIGGER_LIFT);</div><div class="line"> //        scheduler-&gt;device[vacuumSolenoid]-&gt;stopByTriggerpositionOf(gripNewRecord, liftServo, lowerRecordToTable, LIFT_TABLE_POSITION, 0);</div><div class="line"> freeRam();</div><div class="line"> </div><div class="line"> //  lift for going to park position: start with startDelay after turn table was reached (LIFT_TABLE_POSITION)</div><div class="line"> unsigned char liftForParkPosition = scheduler-&gt;device[liftServo]-&gt;addTask(LIFT_UP_POSITION, LIFT_SPEED_FAST, LIFT_ACCEL_FAST, 500);</div><div class="line"> scheduler-&gt;device[liftServo]-&gt;startByTriggerpositionOf(liftForParkPosition, liftServo, lowerRecordToTable, LIFT_TABLE_POSITION);</div><div class="line"> freeRam();</div><div class="line"> </div><div class="line"> //  turn grappler to park position: start when lifting reached triggerPosition (LIFT_UP_TRIGGER_TURN)</div><div class="line"> unsigned char turnToParkPosition = scheduler-&gt;device[turnServo]-&gt;addTask(TURN_PARK_POSITION, TURN_SPEED_FAST, TURN_ACCEL_FAST, NO_START_DELAY);</div><div class="line"> scheduler-&gt;device[turnServo]-&gt;startByTriggerpositionOf(turnToParkPosition, liftServo, liftForParkPosition, LIFT_UP_TRIGGER_TURN);</div><div class="line"> freeRam();</div><div class="line"> </div><div class="line"> //  lower grappler to park position: start when turning reached trigger position (TURN_TO_PARK_TRIGGER_LIFT)</div><div class="line"> unsigned char lowerForParkPosition = scheduler-&gt;device[liftServo]-&gt;addTask(LIFT_PARK_POSITION, LIFT_SPEED_FAST, LIFT_ACCEL_FAST, NO_START_DELAY);</div><div class="line"> scheduler-&gt;device[liftServo]-&gt;startByTriggerpositionOf(lowerForParkPosition, turnServo, turnToParkPosition, TURN_TO_PARK_TRIGGER_LIFT);</div><div class="line"> freeRam();</div><div class="line"> </div><div class="line"> scheduledTask turnTheTable = scheduler-&gt;device[tableDrive]-&gt;addTask(PWM_FULL_POWER, PWM_FREQUENCY_LOW, PWM_NO_RAMPING, PWM_NO_RAMPING);</div><div class="line"> scheduler-&gt;device[tableDrive]-&gt;task[turnTheTable]-&gt;startAfterCompletionOf(catStepper, driveToCuttingStartPosition);</div><div class="line"> //            scheduler-&gt;device[tableDrive]-&gt;task[turnTheTable]-&gt;startByTriggerpositionOf(catStepper, driveToCuttingStartPosition, CAT_CUTTING_START_POSITION - 10000);</div><div class="line"> </div><div class="line"></div><div class="line"> </div><div class="line"> //  make the groves: start when cuttinghead is in cutting position</div><div class="line"> </div><div class="line"> //  lift head after cutting: start, when end groove is finished</div><div class="line"> </div><div class="line"> //  go back to park position: start when cutting head is lifted up</div><div class="line"> </div><div class="line"> //  lower head to record surface: start when reached start position of start groove</div><div class="line"> */</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">/*</div><div class="line"> osascript -e &#39;</div><div class="line"> tell application &quot;System Events&quot;</div><div class="line"> try</div><div class="line"> set serialMonitorWindow to first window of process &quot;Arduino&quot; whose name begins with &quot;/dev/tty.usbmodem&quot;</div><div class="line"> click button 1 of serialMonitorWindow</div><div class="line"> end try</div><div class="line"> end tell</div><div class="line"> &#39;</div><div class="line"> </div><div class="line"> osascript -e &#39;</div><div class="line"> tell application &quot;System Events&quot;</div><div class="line"> try</div><div class="line"> tell application &quot;Arduino&quot; to activate</div><div class="line"> set serialMonitorMenuItem to menu item &quot;Serieller Monitor&quot; of menu &quot;Werkzeuge&quot; of menu bar item &quot;Werkzeuge&quot; of menu bar 1 of process &quot;Arduino&quot;</div><div class="line"> click serialMonitorMenuItem</div><div class="line"> end try</div><div class="line"> end tell</div><div class="line"> &#39;</div><div class="line"> */</div><div class="line"></div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
