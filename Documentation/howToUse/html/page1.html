<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>deviceScheduler: Coding Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">deviceScheduler
   </div>
   <div id="projectbrief">Software zur Steuerung von Schrittmotoren, Modellbau-Servos und DC-Controllern in Echtzeit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Coding Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="createScheduler"></a>
Creating a new scheduler</h1>
<p>Zentrales Objekt ist der Scheduler, eine Instanz der Klasse mit dem Namen <a class="el" href="class_c_c_device_scheduler.html" title="Scheduler engine to manage all devices and their tasks. ">CCDeviceScheduler</a>. Er steuert und koordiniert einen Arbeitsablauf, d.h. verschiedene Geräte führen einen Block von Aufgaben aus. Es können beliebig viele dieser Arbeitsabläufe definiert und in beliebiger Reihenfolge abgerufen werden. Zum Beispiel beim Plattenschneideautomat <code>fetchNewRecord</code>, <code>cuttingProcess</code>, <code>ejectRecord</code> etc. </p><div class="fragment"><div class="line"><a class="code" href="class_c_c_device_scheduler.html">CCDeviceScheduler</a> cuttingProcess = <span class="keyword">new</span> <a class="code" href="class_c_c_device_scheduler.html">CCDeviceScheduler</a>;</div></div><!-- fragment --><p> Ein neues Scheduler-Objekt mit dem Namen <code>cuttingProcess</code> wird erzeugt. Es soll z.B. die komplette Steuerung des Schneideprozesses übernehmen. <br />
<br />
<br />
 </p>
<h1><a class="anchor" id="registerDevice"></a>
Registering Devices</h1>
<p>Für die Geräte existiert eine Basisklasse <a class="el" href="class_c_c_device.html" title="base class for all devices ">CCDevice</a>. Der Scheduler enthält ein Array dieser Basisklasse mit dem namen <code>device</code>, in das alle Geräte eingetragen werden. Es können beliebig viele Geräte zum Scheduler hinzugefügt, d.h. in dieses Array eingetragen werden. Dies geschieht durch die Funktionen <code>addServo</code>(...), <code>addStepper</code>(...), <code>addDcController</code>(...) etc. des Schedulers, in der sämtliche Parameter dieses Geräts übergeben werden: </p><div class="fragment"><div class="line">cuttingProcess-&gt;<a class="code" href="class_c_c_device_scheduler.html#a8a90d14067f097bf18742e4c377d2d1b">addServo</a>(SERVO_NAME, SERVO_PIN, SERVO_MIN_POSITION, SERVO_MAX_POSITION, SERVO_PARK_POSITION);</div></div><!-- fragment --><p> Ein neues Device-Objekt vom Typ Modellbauservo wird dem Device-Array des Schedulers hinzugefügt. Übergeben wird ein Name, mit dem dieses Servo im Ablaufprotokoll erscheint, der Pin, mit dem es gesteuert wird, ein minimaler und ein maximaler Positionswert und die Parkposition. Rückgabewert dieser Funktion ist der Index dieses Gerätes im Geräte-Array <code>device</code> des Schedulers. Es ist ein ganzzahliger Wert, sein Typname ist <code>schedulerDevice</code>. Mit diesem Geräteindex ist das Gerät dann eindeutig identifizierbar. Wird dieser Wert in einer aussagekräftigen Variable gespeichert, ist es sehr einfach, dieses Gerät anzusprechen: </p><div class="fragment"><div class="line"><a class="code" href="device_scheduler_8h.html#a47bba564f12254766f966aa6e7beec94">schedulerDevice</a> liftServo = cuttingProcess-&gt;<a class="code" href="class_c_c_device_scheduler.html#a8a90d14067f097bf18742e4c377d2d1b">addServo</a>(LIFTSERVO_NAME, LIFTSERVO_PIN, LIFTSERVO_MIN_POSITION, LIFTSERVO_MAX_POSITION, LIFTSERVO_PARK_POSITION);</div><div class="line"></div><div class="line">cuttingProcess-&gt;<a class="code" href="class_c_c_device_scheduler.html#a61a690ee17ad29c1be7f805b33961d35">device</a>[liftServo]...</div></div><!-- fragment --><p> Die implementierten Methoden sind:</p><ul>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_device_scheduler.html">CCDeviceScheduler</a>-&gt;<a class="code" href="class_c_c_device_scheduler.html#a8a90d14067f097bf18742e4c377d2d1b">addServo</a>(...) </div></div><!-- fragment --></li>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_device_scheduler.html">CCDeviceScheduler</a>-&gt;<a class="code" href="class_c_c_device_scheduler.html#a7c31927f25a6bb75de7310da4e13e543">addDcController</a>(...) </div></div><!-- fragment --></li>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_device_scheduler.html">CCDeviceScheduler</a>-&gt;<a class="code" href="class_c_c_device_scheduler.html#a2fba4b9f0bf735213a1ec7e1a8205741">addStepper_A4988</a>(...) </div></div><!-- fragment --></li>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_device_scheduler.html">CCDeviceScheduler</a>-&gt;<a class="code" href="class_c_c_device_scheduler.html#aaed9878d5902c81ea1cfb9d6963fcec1">addStepper_TMC260</a>(...) </div></div><!-- fragment --> <br />
<br />
 </li>
</ul>
<h1><a class="anchor" id="registerTask"></a>
Registering Tasks</h1>
<p>Zu diesen Geräten des Schedulers können nun beliebig viele Aufgaben hinzugefügt werden. Für die Aufgaben existiert eine Klasse mit dem Namen <a class="el" href="class_c_c_task.html" title="Class for tasks to be executed. ">CCTask</a>. Die Klasse <a class="el" href="class_c_c_device.html" title="base class for all devices ">CCDevice</a> enthält ein Aufgaben-Array mit dem Namen <code>task</code>. Die Eintragung von Aufgaben in dieses Array bewerkstelligt die Funktion <code>addTask</code>(...) des jeweiligen Gerätes: Übergeben werden sämtliche Parameter dieser Aufgabe: </p><div class="fragment"><div class="line"><a class="code" href="device_scheduler_8h.html#ae5841fd44d6e01bbac6e04706ff5c9db">scheduledTask</a> lowerHeadForCutting = cuttingProcess-&gt;<a class="code" href="class_c_c_device_scheduler.html#a61a690ee17ad29c1be7f805b33961d35">device</a>[liftServo]-&gt;<a class="code" href="class_c_c_device.html#a70f50b83cfa5fcc903b7e8121f4e0e11">addTask</a>(CUTING_POSITION, SPEED_SLOW, ACCELERATION_NORMAL, DECELERATION_SLOW);</div></div><!-- fragment --><p> Dem Gerät <code>liftServo</code> wird eine neue Aufgabe hinzugefügt: Fahre zur Position <code>CUTTING_POSITION</code> mit der Geschwindigkeit <code>SPEED_SLOW</code>, der Beschleunigung <code>ACCELERATION_NORMAL</code> bzw. <code>DECELERATION_SLOW</code>. Die Aufgabe startet ohne Startverzögerung. Rückgabewert dieser Funktion ist wiederum der Index dieser Aufgabe im Aufgaben-Array, mit dem diese Aufgabe eindeutig identifiziert ist. Dieser Wert wird wiederum in einer aussagekräftigen Variable gespeichert, damit sie später leicht angesprochen werden kann. <br />
 Die implementierten Methoden sind:</p><ul>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_device.html">CCDevice</a>-&gt;<a class="code" href="class_c_c_device.html#a70f50b83cfa5fcc903b7e8121f4e0e11">addTask</a>(...) </div></div><!-- fragment --></li>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_device.html">CCDevice</a>-&gt;<a class="code" href="class_c_c_device.html#a1e8707afdadf8df7fc79c9c1503b92f4">addTaskWithStartDelay</a>(...) </div></div><!-- fragment --> <br />
<br />
 </li>
</ul>
<h1><a class="anchor" id="LinkTask"></a>
Linking Tasks Together</h1>
<p>Gestartet, gestoppt und manipuliert werden können die Geräte durch Zeitablauf, durch die Zustandsänderung angeschlossener Sensoren, durch das Erreichen eines Zustandes bzw. einer Position dieses Gerätes sowie durch das Erreichen eines Zustandes bzw. einer Position jedes anderen Gerätes. </p><div class="fragment"><div class="line">cuttingProcess-&gt;<a class="code" href="class_c_c_device_scheduler.html#a61a690ee17ad29c1be7f805b33961d35">device</a>[catStepper]-&gt;<a class="code" href="class_c_c_device.html#aa90f3e5635cf219165db4f4d4a537d46">task</a>[driveCatToCuttingStartPosition]-&gt;<a class="code" href="class_c_c_task.html#a260dc9d4d4fd1377e57deb7f92fde19d">startByDate</a>(100);</div></div><!-- fragment --><p> Die Aufgabe <code>driveCatToCuttingStartPosition</code> des Gerätes <code>catStepper</code> soll 100 ms nachdem der Scheduler gestartet wurde, ausgeführt werden. </p><div class="fragment"><div class="line">cuttingProcess-&gt;<a class="code" href="class_c_c_device_scheduler.html#a61a690ee17ad29c1be7f805b33961d35">device</a>[liftServo]-&gt;<a class="code" href="class_c_c_device.html#aa90f3e5635cf219165db4f4d4a537d46">task</a>[lowerHeadForCutting]-&gt;<a class="code" href="class_c_c_task.html#a1770230e14389b1bc149c8dc8a876264">startAfterCompletionOf</a>(catStepper, driveCatToCuttingStartPosition);</div></div><!-- fragment --><p> Die Aufgabe <code>lowerHeadForCutting</code> wird gestartet, nachdem die Aufgabe <code>driveCatToCuttingStart</code> des Schneideschlittenantriebs (<code>catStepper</code>) abgeschlossen ist. </p><div class="fragment"><div class="line">cuttingProcess-&gt;<a class="code" href="class_c_c_device_scheduler.html#a61a690ee17ad29c1be7f805b33961d35">device</a>[liftServo]-&gt;<a class="code" href="class_c_c_device.html#aa90f3e5635cf219165db4f4d4a537d46">task</a>[lowerHeadForCutting]-&gt;<a class="code" href="class_c_c_task.html#ae1dcbe01727cada89d9c2aeb8b3403ba">stopDynamicallyBySensor</a>(DISTANCE_SENSOR, INITIATE_STOP_VALUE, TARGET_VALUE, STOP_PERFORMANCE, <a class="code" href="device_scheduler_8h.html#abb664f16e10d899b378c70b8c4643210a47af37576db66b8adcd894d5d3e5ddd7">SKIP_APPROXIMATION_PRECISE</a>);</div></div><!-- fragment --><p> Die Aufgabe "lowerHeadForCutting" wird entsprechend der Sensorwerte des Distanzsensors im Schneidekopf dynamisch gestoppt. Die Fahrgeschwindigkeit wird entsprechend der Sensorwerte geregelt. <br />
 Die implementierten Methoden sind:</p><ul>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_task.html">CCTask</a>-&gt;<a class="code" href="class_c_c_task.html#a260dc9d4d4fd1377e57deb7f92fde19d">startByDate</a>(...) </div></div><!-- fragment --></li>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_task.html">CCTask</a>-&gt;<a class="code" href="class_c_c_task.html#a1770230e14389b1bc149c8dc8a876264">startAfterCompletionOf</a>(...) </div></div><!-- fragment --></li>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_task.html">CCTask</a>-&gt;<a class="code" href="class_c_c_task.html#a4698de57044b50122d97e221e4185ee1">startByTriggerpositionOf</a>(...) </div></div><!-- fragment --></li>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_task.html">CCTask</a>-&gt;<a class="code" href="class_c_c_task.html#a60861e128157e46cd28e0b4ca9298f81">switchToNextTaskByDate</a>(...) </div></div><!-- fragment --></li>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_task.html">CCTask</a>-&gt;<a class="code" href="class_c_c_task.html#a72c0c2da5ac899ee00510ab0ce0bda20">switchToNextTaskByButton</a>(...) </div></div><!-- fragment --></li>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_task.html">CCTask</a>-&gt;<a class="code" href="class_c_c_task.html#afee2e3fdebe25866c0ab8822e84b7cce">switchToNextTaskAfterCompletionOf</a>(...) </div></div><!-- fragment --></li>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_task.html">CCTask</a>-&gt;<a class="code" href="class_c_c_task.html#a0e9ac072aa8e1de7a5c09dcab6f763a3">switchToNextTaskByTriggerpositionOf</a>(...) </div></div><!-- fragment --></li>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_task.html">CCTask</a>-&gt;<a class="code" href="class_c_c_task.html#a6f7d1d332f07ba57e5449342ac05d7ad">stopByTimeout</a>(...) </div></div><!-- fragment --></li>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_task.html">CCTask</a>-&gt;<a class="code" href="class_c_c_task.html#a2639ff3629155391d9c9af08304ebfce">stopByButton</a>(...) </div></div><!-- fragment --></li>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_task.html">CCTask</a>-&gt;<a class="code" href="class_c_c_task.html#acd7e737fb5c467a78218f78e0409fce6">stopAfterCompletionOf</a>(...) </div></div><!-- fragment --></li>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_task.html">CCTask</a>-&gt;<a class="code" href="class_c_c_task.html#ab8ed61be77112fe9737fa14e660c90f9">stopByTriggerpositionOf</a>(...) </div></div><!-- fragment --></li>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_task.html">CCTask</a>-&gt;<a class="code" href="class_c_c_task.html#ae1dcbe01727cada89d9c2aeb8b3403ba">stopDynamicallyBySensor</a>(...) </div></div><!-- fragment --> <br />
<br />
 </li>
</ul>
<h1><a class="anchor" id="registerActions"></a>
Registering Action Buttons</h1>
<p>Zu dem Scheduler können nun noch beliebig viele Bedienungselemente hinzugefügt werden. Mittels dieser Schalter kann die Abarbeitung der Aufgaben manipuliert werden. Aufgaben können gestoppt, übersprungen oder wiederholt werden. In der Klasse <a class="el" href="class_c_c_device_scheduler.html" title="Scheduler engine to manage all devices and their tasks. ">CCDeviceScheduler</a> existiert ein Array der Klasse <a class="el" href="class_c_c_control_button.html" title="Class for buttons to control the workflow. ">CCControlButton</a>. Dort werden die Schalter eingetragen: </p><div class="fragment"><div class="line"><a class="code" href="device_scheduler_8h.html#afdf0c93f269ef2ece4b433be7117f927">schedulerControlButton</a> songEndButton = cuttingProcess-&gt;<a class="code" href="class_c_c_device_scheduler.html#abfde230c2f604db30e971c572552f21d">addControlButton</a>(<a class="code" href="device_scheduler_8h.html#aee658e3f03d4935346ca8ca8bee2618c">SONG_END_BUTTON_NAME</a>, <a class="code" href="device_scheduler_8h.html#abc781360180894ab49a4fa32b1e03637">SONG_END_PIN</a>, <a class="code" href="device_scheduler_8h.html#aa7ab3303e4648bb2d046cc2ca99d17e4">SONG_END_ACTIV</a>);</div></div><!-- fragment --><p> Jedes Element dieser Klasse enthält ein Array von <code>actions</code>, die das Stoppen, Überspringen oder Wiederholen von Aufgaben veranlassen. Die Eintragung dieser <code>actions</code> bewerkstelligt die Funktion <code>evokeTaskJump</code>(...) bzw. <code>evokeTaskJumpToTask</code>(...). Übergeben werden sämtliche Parameter dieser Aufgabe: </p><div class="fragment"><div class="line">cuttingProcess-&gt;<a class="code" href="class_c_c_device_scheduler.html#a939d94c0f0fe68781226d336068407ab">controlButton</a>[songEndButton]-&gt;<a class="code" href="class_c_c_control_button.html#abdb122036db1e1a4c9bd8c0a3274f280">evokeTaskJumpToTask</a>(catStepper, makeMainGroove, <a class="code" href="device_scheduler_8h.html#a46e69191c64a1194a22bc13d7e77263fafd0edba01824bda61f8fcb0593c9019a">STOP_AND_SWITCH</a>, makeEndGroove);</div></div><!-- fragment --><p> Die Aufgabe <code>makeMainGroove</code> des Schneideschlittenantriebs <code>catStepper</code>, also der Schneideprozess, soll abgebrochen werden, wenn der aufzunehmende Song bereits vor dem Ablauf der eingestellten Aufnahmedauer zu ende ist. Dies wird mit dem Schalter <code>songEndButton</code> signalisiert. Der Schneideschlittenantrieb soll dann die Aufgabe <code>makeMainGroove</code> beenden und direkt zur Aufgabe <code>makeEndGroove</code> wechseln, also übergangslos zu der Geschwindigkeit beschleunigen, die zum Schneiden der Endrille notwendig ist. <br />
 Die implementierten Methoden sind:</p><ul>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_control_button.html">CCControlButton</a>-&gt;<a class="code" href="class_c_c_control_button.html#a16ef8a74cbc2d803faff975b763b72e4">evokeTaskJump</a>(...) </div></div><!-- fragment --></li>
<li><div class="fragment"><div class="line"><a class="code" href="class_c_c_control_button.html">CCControlButton</a>-&gt;<a class="code" href="class_c_c_control_button.html#abdb122036db1e1a4c9bd8c0a3274f280">evokeTaskJumpToTask</a>(...) </div></div><!-- fragment --> <br />
<br />
 </li>
</ul>
<h1><a class="anchor" id="run"></a>
Run the Process</h1>
<p>Um den nun fertig konfigurierten Prozess zu starten dient der Befehl <code>run</code>. </p><div class="fragment"><div class="line">cuttingProcess-&gt;<a class="code" href="class_c_c_device_scheduler.html#a13a43e6d814de94978c515cb084873b1">run</a>();</div></div><!-- fragment --><p> <br />
<br />
 </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
