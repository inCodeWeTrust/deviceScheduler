<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>deviceScheduler: HowToUseIt</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">deviceScheduler
   </div>
   <div id="projectbrief">Schduler to controll Stepper-, Servo- and DC-Controller-Devices in Real Time</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_HowToUseIt.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">HowToUseIt </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Prinzipielle Programmierung</h1>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;/* create a scheduler object */</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;cuttingProcess = new CCDeviceScheduler;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;/* add the devices */</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;unsigned char catStepper = cuttingProcess-&gt;addStepper(CATSTEPPER_NAME, CATSTEPPER_STEP_PIN, CATSTEPPER_DIR_PIN, CATSTEPPER_ENABLE_PIN, CATSTEPPER_HIGHEST_STEPPINGMODE, CATSTEPPER_STEPMODECODES, CATSTEPPER_MICROSTEPPINS, CATSTEPPER_STEPS_PER_ROTATION);</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;unsigned char liftServo = cuttingProcess-&gt;addServo(LIFTSERVO_NAME, LIFTSERVO_PIN, LIFTSERVO_MIN_POSITION, LIFTSERVO_MAX_POSITION, LIFTSERVO_PARK_POSITION);</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    ...</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;/* add the tasks */</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;unsigned char lowerHeadForCutting = cuttingProcess-&gt;device[liftServo]-&gt;addTask(CUTING_POSITION, SPEED_SLOW, ACCELERATION_NORMAL, DECELERATION_SLOW);</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;unsigned char driveCatToCuttingStartPosition = cuttingProcess-&gt;device[catStepper]-&gt;addTask(CUTTING_START_POSITION, SPEED_HIGH, ACCELERATION_HIGH, DECELERATION_HIGH);</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    ...</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;/* link the tasks together */</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;cuttingProcess-&gt;device[catStepper]-&gt;task[driveCatToCuttingStartPosition]-&gt;startByDate(100);</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;cuttingProcess-&gt;device[liftServo]-&gt;task[lowerHeadForCutting]-&gt;startAfterCompletionOf(catStepper, driveCatToCuttingStartPosition);</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;cuttingProcess-&gt;device[liftServo]-&gt;task[lowerHeadForCutting]-&gt;stopDynamicallyBySensor(DISTANCE_SENSOR, INITIATE_STOP_VALUE, TARGET_VALUE, ATTENUATION, STOP_VERY_PRECISE);</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    ...</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;/* run the tasks */</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;cuttingProcess-&gt;run();</div></div><!-- fragment --><p> </p><h1>Funktionsweise</h1>
<p>Zentrales Objekt ist der Scheduler, eine Instanz der Klasse mit dem Namen <a class="el" href="class_c_c_device_scheduler.html" title="Scheduler engine to manage all devices and their tasks. ">CCDeviceScheduler</a>. Er steuert und koordiniert einen Arbeitsablauf, d.h. verschiedene Geräte führen einen Block von Aufgaben aus. Es können beliebig viele dieser Arbeitsabläufe definiert und in beliebiger Reihenfolge abgerufen werden. Zum Beispiel „fetchNewRecord“, „cuttingProcess“, „ejectRecord“ etc.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cuttingProcess = new CCDeviceScheduler;</div></div><!-- fragment --><p><em>Ein neues Scheduler-Objekt mit dem Namen „cuttingProcess“ wird erzeugt. Es soll die komplette Steuerung des Schneideprozesses übernehmen.</em></p>
<p><br />
</p>
<p>Für die Geräte existiert eine Basisklasse „CCDevice“ bzw. die eigens entwickelten abgeleiteten Klassen „CCServoDevice“, „CCStepperDevice“ „CCSwitchingDevice“. Als abgeleitete Geräteklassen haben sie alle das gleiche Interface, verfügen also alle über die gleichen Methoden, z.B. „prepareMove()“, „startMove()“, „drive()“, „stopMove()“ etc. Sie sind insofern alle auf die gleiche Weise zu handhaben, wenngleich die Implementierung dieser Funktionen freilich in jeder abgeleiteten Klasse völlig unterschiedlich ist. Diese richtet sich nach dem zu steuernden Gerät und dessen Anforderungen, ob beispielsweise bei der Schrittmotor-Klasse Impulse genau zum richtigen Zeitpunkt oder bei der Servo-Klasse Impulse der exakt richtigen Länge generiert werden müssen. An die Geräteklasse der Motoren werden der Endpunkt, die gewünschte Beschleunigung sowie die gewünschte Geschwindigkeit übergeben. Die Geräteklassen beschleunigen den Motor mit konstanter Beschleunigung vom Stillstand bis zur gewünschten Geschwindigkeit und bremsen ihn mit konstanter Beschleunigung bis zum Stillstand an der Zielposition ab. Wenn notwendig, könnten hier weitere abgeleitete Klassen z.B. zur gepulsten Steuerung von Elektromagneten o.ä. hinzugefügt werden.</p>
<p>Der Scheduler enthält ein Array dieser Basisklasse „CCDevice“, in das alle Geräte eingetragen werden. Es können beliebig viele Geräte (Instanzen der abgeleiteten Klassen dieser Klasse) zum Scheduler hinzugefügt, d.h. in dieses Array eingetragen werden. Dies geschieht durch die Funktionen „addServo(...)“, „addStepper(...)“, „addSwitch(...)“ etc. des Schedulers, in der sämtliche Parameter dieses Geräts übergeben werden:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;unsigned char liftServo = cuttingProcess-&gt;addServo(LIFTSERVO_NAME, LIFTSERVO_PIN, LIFTSERVO_MIN_POSITION, LIFTSERVO_MAX_POSITION, LIFTSERVO_PARK_POSITION);</div></div><!-- fragment --><p><em>Ein neues Device-Objekt vom Typ Modellbauservo wird dem Device-Array des Schedulers hinzugefügt. Das Device-Array des Schedulers heißt „device“. Übergeben wird ein Name, mit dem dieses Servo im Ablaufprotokoll erscheint, der Pin, mit dem es gesteuert wird, ein minimaler und ein maximaler Positionswert und die Parkposition.</em></p>
<p><br />
</p>
<p>Rückgabewert dieser Funktion ist der Index dieses Gerätes im Geräte-Array („device[]“) des Schedulers. Mit diesem Geräteindex ist das Gerät dann eindeutig identifizierbar. Wird dieser Wert in einer aussagekräftigen Variable gespeichert, ist es sehr einfach, dieses Gerät anzusprechen:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cuttingProcess-&gt;device[liftServo]...</div></div><!-- fragment --><p><br />
</p>
<p>Zu diesen Geräten des Schedulers können nun beliebig viele Aufgaben hinzugefügt werden. Die Klasse „CCDevice“ enthält ein Aufgaben-Array mit dem Namen „task[]“. Die Eintragung von Aufgaben in dieses Array bewerkstelligt die Funktion addTask(...) des jeweiligen Gerätes: Übergeben werden sämtliche Parameter dieser Aufgabe:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;unsigned char lowerHeadForCutting = cuttingProcess-&gt;device[liftServo]-&gt;addTask(CUTING_POSITION, SPEED_SLOW, ACCELERATION_NORMAL, DECELERATION_SLOW, NO_DELAY);</div></div><!-- fragment --><p><em>Dem Gerät "liftServo" wird eine neue Aufgabe hinzugefügt: Fahre zur Position "CUTTING_POSITION" mit der Geschwindigkeit "SPEED_SLOW", der Beschleunigung "ACCELERATION_NORMAL" bzw. "DECELERATION_SLOW". Die Aufgabe startet ohne Startverzögerung. Sein Index wird in der Variable „lowerHeadForCutting“ abgelegt.</em></p>
<p><br />
</p>
<p>Rückgabewert dieser Funktion ist wiederum der Index dieser Aufgabe im Aufgaben-Array, mit dem diese Aufgabe eindeutig identifiziert ist. Dieser Wert wird wiederum in einer aussagekräftigen Variable gespeichert, damit sie später leicht angesprochen werden kann.</p>
<p>Gestartet, gestoppt und manipuliert werden können die Geräte durch Zeitablauf, durch die Zustandsänderung angeschlossener Sensoren, durch das Erreichen eines Zustandes bzw. einer Position dieses Gerätes sowie durch das Erreichen eines Zustandes bzw. einer Position jedes anderen Gerätes. Entsprechend lauten die Methoden der Aufgaben („task[]“): startByDate(...), startByButton(...), startAfterMy(...), startAfterCompletionOf(...), startByTriggerpositionOf(...), switchToNextTaskByDate(...), switchToNextTaskByButton(...), switchToNextTaskAfterCompletionOf(...), switchToNextTaskByTriggerpositionOf(...), stopByTimeout(...), stopByButton(...), stopAfterCompletionOf(...), stopByTriggerpositionOf(...), stopDynamicallyBySensor(...);</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cuttingProcess-&gt;device[catStepper]-&gt;task[driveCatToCuttingStartPosition]-&gt;startByDate(100);</div></div><!-- fragment --><p><em>Die Aufgabe "driveCatToCuttingStartPosition" soll 100 ms nachdem der Scheduler („cuttingProcess“) gestartet wurde, ausgeführt werden.</em></p>
<p><br />
</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cuttingProcess-&gt;device[liftServo]-&gt;task[lowerHeadForCutting]-&gt;startAfterCompletionOf(catStepper, driveCatToCuttingStartPosition);</div></div><!-- fragment --><p><em>Die Aufgabe "lowerHeadForCutting" wird gestartet, nachdem die Aufgabe "driveCatToCuttingStart" des Schneideschlittenantriebs abgeschlossen ist.</em></p>
<p><br />
</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cuttingProcess-&gt;device[liftServo]-&gt;task[lowerHeadForCutting]-&gt;stopDynamicallyBySensor(DISTANCE_SENSOR, INITIATE_STOP_VALUE, TARGET_VALUE, ATTENUATION, STOP_VERY_PRECISE);</div></div><!-- fragment --><p><em>Die Aufgabe "lowerHeadForCutting" wird entsprechend der Sensorwerte des Distanzsensors im Schneidekopf dynamisch gestoppt.</em></p>
<p><br />
</p>
<p>Nachdem die Parameter aller Aufgaben definiert sind, kann der Prozess gestartet werden. Jetzt startet, koordiniert und beendet der Scheduler alle Aufgaben entsprechend der Eingabe.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cuttingProcess-&gt;run();</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
